# MkSaaS Template ç™»å½•æ³¨å†Œç³»ç»Ÿè¯¦ç»†åˆ†æ

**ç”Ÿæˆæ—¶é—´**: 2025å¹´9æœˆ11æ—¥ 15:31:48 (UTC+8)
**åˆ†æç‰ˆæœ¬**: mksaas-template v0.1.0

## ç³»ç»Ÿæ¦‚è¿°

MkSaaS Template ä½¿ç”¨ **Better Auth** ä½œä¸ºæ ¸å¿ƒè®¤è¯ç³»ç»Ÿï¼Œæä¾›å®Œæ•´çš„ç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€é‚®ç®±éªŒè¯ç­‰åŠŸèƒ½ã€‚æ•´ä¸ªç³»ç»Ÿé‡‡ç”¨ç°ä»£åŒ–çš„æ¶æ„è®¾è®¡ï¼Œæ”¯æŒå¤šç§ç™»å½•æ–¹å¼ï¼Œå…·æœ‰å®Œå–„çš„å®‰å…¨æœºåˆ¶å’Œç”¨æˆ·ä½“éªŒä¼˜åŒ–ã€‚

### æ ¸å¿ƒç‰¹æ€§
- ğŸ” **å¤šç§ç™»å½•æ–¹å¼**: é‚®ç®±å¯†ç ã€Google OAuthã€GitHub OAuth
- ğŸ“§ **é‚®ç®±éªŒè¯**: å¿…é¡»éªŒè¯é‚®ç®±åæ‰èƒ½ä½¿ç”¨ç³»ç»Ÿ
- ğŸ›¡ï¸ **å®‰å…¨é˜²æŠ¤**: Turnstile éªŒè¯ç ã€ä¼šè¯ç®¡ç†ã€CSRF ä¿æŠ¤
- ğŸŒ **å›½é™…åŒ–æ”¯æŒ**: ä¸­è‹±æ–‡ç•Œé¢å’Œé‚®ä»¶æ¨¡æ¿
- ğŸ **æ–°ç”¨æˆ·å¥–åŠ±**: æ³¨å†Œèµ é€ç§¯åˆ†ã€è‡ªåŠ¨è®¢é˜…æ–°é—»
- ğŸ“Š **å®Œæ•´è¿½è¸ª**: ç”¨æˆ·è¡Œä¸ºè®°å½•å’Œæ•°æ®åˆ†æ

## æŠ€æœ¯æ¶æ„

### 1. è®¤è¯æ¡†æ¶
- **Better Auth 1.1.19**: ç°ä»£åŒ–çš„ TypeScript è®¤è¯åº“
- **Drizzle ORM**: æ•°æ®åº“é€‚é…å™¨
- **PostgreSQL**: ç”¨æˆ·æ•°æ®å­˜å‚¨

### 2. å‰ç«¯ç»„ä»¶
- **React Hook Form**: è¡¨å•ç®¡ç†
- **Zod**: æ•°æ®éªŒè¯
- **Tailwind CSS**: æ ·å¼ç³»ç»Ÿ
- **Radix UI**: æ— éšœç¢ç»„ä»¶

### 3. åç«¯æœåŠ¡
- **Next.js API Routes**: è®¤è¯ç«¯ç‚¹
- **Server Actions**: æœåŠ¡å™¨ç«¯æ“ä½œ
- **Email Templates**: React é‚®ä»¶æ¨¡æ¿

## Better Auth æ¶æ„è§’è‰²åˆ†æ

### Better Auth åœ¨ç³»ç»Ÿä¸­çš„æ ¸å¿ƒä½œç”¨

Better Auth åœ¨ MkSaaS Template ä¸­æ‰®æ¼”ç€ **è®¤è¯ä¸­å°** çš„æ ¸å¿ƒè§’è‰²ï¼Œå®ƒæ˜¯æ•´ä¸ªç”¨æˆ·è®¤è¯ä½“ç³»çš„å¤§è„‘å’Œæ¢çº½ã€‚

#### 1. æ¶æ„å®šä½
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å‰ç«¯åº”ç”¨å±‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   æ³¨å†Œè¡¨å•       â”‚  â”‚   ç™»å½•è¡¨å•       â”‚  â”‚  ç¤¾äº¤ç™»å½•     â”‚  â”‚
â”‚  â”‚ RegisterForm    â”‚  â”‚  LoginForm      â”‚  â”‚ SocialLogin  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                Better Auth å®¢æˆ·ç«¯                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              authClient (React)                         â”‚ â”‚
â”‚  â”‚  â€¢ signUp.email()    â€¢ signIn.email()                  â”‚ â”‚
â”‚  â”‚  â€¢ signIn.social()   â€¢ useSession()                    â”‚ â”‚
â”‚  â”‚  â€¢ signOut()         â€¢ resetPassword()                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼ HTTP API è°ƒç”¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                Better Auth æœåŠ¡ç«¯                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                 auth å®ä¾‹                               â”‚ â”‚
â”‚  â”‚  â€¢ API è·¯ç”±å¤„ç†    â€¢ ä¼šè¯ç®¡ç†    â€¢ å¯†ç å“ˆå¸Œ             â”‚ â”‚
â”‚  â”‚  â€¢ OAuth æµç¨‹      â€¢ é‚®ä»¶å‘é€    â€¢ æ•°æ®åº“æ“ä½œ           â”‚ â”‚
â”‚  â”‚  â€¢ é’©å­æ‰§è¡Œ        â€¢ æ’ä»¶ç³»ç»Ÿ    â€¢ é”™è¯¯å¤„ç†             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ•°æ®æŒä¹…å±‚                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚    ç”¨æˆ·è¡¨    â”‚  â”‚   ä¼šè¯è¡¨     â”‚  â”‚   è´¦å·è¡¨     â”‚         â”‚
â”‚  â”‚    user     â”‚  â”‚  session    â”‚  â”‚  account    â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2. æ ¸å¿ƒèŒè´£

**ğŸ¯ ç»Ÿä¸€è®¤è¯å…¥å£**
- æä¾›æ ‡å‡†åŒ–çš„è®¤è¯ API æ¥å£
- æ”¯æŒå¤šç§è®¤è¯æ–¹å¼çš„ç»Ÿä¸€ç®¡ç†
- å¤„ç†æ‰€æœ‰è®¤è¯ç›¸å…³çš„ HTTP è¯·æ±‚

**ğŸ” å®‰å…¨ä¿éšœä¸­å¿ƒ**
- å¯†ç åŠ å¯†å’ŒéªŒè¯
- ä¼šè¯åˆ›å»ºå’Œç®¡ç†
- CSRF ä¿æŠ¤å’Œå®‰å…¨æ£€æŸ¥
- ä»¤ç‰Œç”Ÿæˆå’ŒéªŒè¯

**ğŸ”„ ä¸šåŠ¡æµç¨‹ç¼–æ’**
- æ³¨å†Œæµç¨‹çš„å®Œæ•´ç®¡ç†
- ç™»å½•éªŒè¯çš„æ ‡å‡†åŒ–å¤„ç†
- é‚®ç®±éªŒè¯çš„è‡ªåŠ¨åŒ–æµç¨‹
- å¯†ç é‡ç½®çš„å®‰å…¨æµç¨‹

**ğŸ”Œ æ‰©å±•èƒ½åŠ›æä¾›**
- æ’ä»¶ç³»ç»Ÿæ”¯æŒåŠŸèƒ½æ‰©å±•
- é’©å­æœºåˆ¶æ”¯æŒä¸šåŠ¡é›†æˆ
- é€‚é…å™¨æ¨¡å¼æ”¯æŒå¤šç§æ•°æ®åº“

#### 3. å…³é”®ç»„ä»¶è¯´æ˜

**æœåŠ¡ç«¯ç»„ä»¶ (`src/lib/auth.ts`)**
```typescript
export const auth = betterAuth({
  // æ ¸å¿ƒé…ç½®
  baseURL: getBaseUrl(),
  database: drizzleAdapter(await getDb()),

  // åŠŸèƒ½æ¨¡å—
  emailAndPassword: { enabled: true },
  socialProviders: { google: {}, github: {} },
  emailVerification: { autoSignInAfterVerification: true },

  // ä¸šåŠ¡é›†æˆ
  databaseHooks: {
    user: {
      create: { after: async (user) => await onCreateUser(user) }
    }
  }
});
```

**å®¢æˆ·ç«¯ç»„ä»¶ (`src/lib/auth-client.ts`)**
```typescript
export const authClient = createAuthClient({
  baseURL: getBaseUrl(),
  plugins: [
    adminClient(),
    inferAdditionalFields<typeof auth>()
  ]
});
```

**API è·¯ç”±å¤„ç† (`src/app/api/auth/[...all]/route.ts`)**
```typescript
export const { POST, GET } = toNextJsHandler(auth);
```

#### 4. æ•°æ®æµè½¬æœºåˆ¶

Better Auth é‡‡ç”¨ **è¯·æ±‚-å“åº”** çš„æ•°æ®æµè½¬æœºåˆ¶ï¼š

```
å‰ç«¯è¡¨å•æäº¤
    â†“
authClient æ–¹æ³•è°ƒç”¨
    â†“
HTTP è¯·æ±‚ (/api/auth/*)
    â†“
Better Auth è·¯ç”±å¤„ç†
    â†“
ä¸šåŠ¡é€»è¾‘æ‰§è¡Œ
    â†“
æ•°æ®åº“æ“ä½œ
    â†“
é’©å­å‡½æ•°è§¦å‘
    â†“
å“åº”è¿”å›å‰ç«¯
```

#### 5. ä¸å…¶ä»–ç³»ç»Ÿçš„é›†æˆ

**ç§¯åˆ†ç³»ç»Ÿé›†æˆ**
```typescript
databaseHooks: {
  user: {
    create: {
      after: async (user) => {
        // æ³¨å†Œèµ é€ç§¯åˆ†
        await addRegisterGiftCredits(user.id);
      }
    }
  }
}
```

**é‚®ä»¶ç³»ç»Ÿé›†æˆ**
```typescript
emailVerification: {
  sendVerificationEmail: async ({ user, url, token }, request) => {
    await sendEmail({
      to: user.email,
      template: 'verifyEmail',
      context: { url, name: user.name }
    });
  }
}
```

**æ–°é—»è®¢é˜…é›†æˆ**
```typescript
async function onCreateUser(user: User) {
  if (websiteConfig.newsletter.autoSubscribeAfterSignUp) {
    setTimeout(async () => {
      await subscribe(user.email);
    }, 2000);
  }
}
```

## æ•°æ®åº“è®¾è®¡

### æ ¸å¿ƒè¡¨ç»“æ„

#### 1. user è¡¨ (ç”¨æˆ·åŸºç¡€ä¿¡æ¯)
```sql
CREATE TABLE user (
  id TEXT PRIMARY KEY,                    -- ç”¨æˆ·å”¯ä¸€æ ‡è¯†
  name TEXT NOT NULL,                     -- ç”¨æˆ·å§“å
  email TEXT NOT NULL UNIQUE,             -- é‚®ç®±åœ°å€
  email_verified BOOLEAN NOT NULL,        -- é‚®ç®±éªŒè¯çŠ¶æ€
  image TEXT,                             -- å¤´åƒURL
  created_at TIMESTAMP NOT NULL,          -- åˆ›å»ºæ—¶é—´
  updated_at TIMESTAMP NOT NULL,          -- æ›´æ–°æ—¶é—´
  role TEXT,                              -- ç”¨æˆ·è§’è‰²
  banned BOOLEAN,                         -- å°ç¦çŠ¶æ€
  ban_reason TEXT,                        -- å°ç¦åŸå› 
  ban_expires TIMESTAMP,                  -- å°ç¦è¿‡æœŸæ—¶é—´
  customer_id TEXT                        -- Stripeå®¢æˆ·ID
);

-- ç´¢å¼•ä¼˜åŒ–
CREATE INDEX user_id_idx ON user(id);
CREATE INDEX user_customer_id_idx ON user(customer_id);
CREATE INDEX user_role_idx ON user(role);
```

#### 2. session è¡¨ (ä¼šè¯ç®¡ç†)
```sql
CREATE TABLE session (
  id TEXT PRIMARY KEY,                    -- ä¼šè¯ID
  expires_at TIMESTAMP NOT NULL,          -- è¿‡æœŸæ—¶é—´
  token TEXT NOT NULL UNIQUE,             -- ä¼šè¯ä»¤ç‰Œ
  created_at TIMESTAMP NOT NULL,          -- åˆ›å»ºæ—¶é—´
  updated_at TIMESTAMP NOT NULL,          -- æ›´æ–°æ—¶é—´
  ip_address TEXT,                        -- IPåœ°å€
  user_agent TEXT,                        -- ç”¨æˆ·ä»£ç†
  user_id TEXT NOT NULL REFERENCES user(id) ON DELETE CASCADE,
  impersonated_by TEXT                    -- ä»£ç†ç”¨æˆ·ID
);

-- ç´¢å¼•ä¼˜åŒ–
CREATE INDEX session_token_idx ON session(token);
CREATE INDEX session_user_id_idx ON session(user_id);
```

#### 3. account è¡¨ (ç¬¬ä¸‰æ–¹è´¦å·å…³è”)
```sql
CREATE TABLE account (
  id TEXT PRIMARY KEY,                    -- è´¦å·ID
  account_id TEXT NOT NULL,               -- ç¬¬ä¸‰æ–¹è´¦å·ID
  provider_id TEXT NOT NULL,              -- æä¾›å•†ID (google/github)
  user_id TEXT NOT NULL REFERENCES user(id) ON DELETE CASCADE,
  access_token TEXT,                      -- è®¿é—®ä»¤ç‰Œ
  refresh_token TEXT,                     -- åˆ·æ–°ä»¤ç‰Œ
  id_token TEXT,                          -- IDä»¤ç‰Œ
  access_token_expires_at TIMESTAMP,      -- è®¿é—®ä»¤ç‰Œè¿‡æœŸæ—¶é—´
  refresh_token_expires_at TIMESTAMP,     -- åˆ·æ–°ä»¤ç‰Œè¿‡æœŸæ—¶é—´
  scope TEXT,                             -- æƒé™èŒƒå›´
  password TEXT,                          -- å¯†ç å“ˆå¸Œ
  created_at TIMESTAMP NOT NULL,          -- åˆ›å»ºæ—¶é—´
  updated_at TIMESTAMP NOT NULL           -- æ›´æ–°æ—¶é—´
);

-- ç´¢å¼•ä¼˜åŒ–
CREATE INDEX account_user_id_idx ON account(user_id);
CREATE INDEX account_account_id_idx ON account(account_id);
CREATE INDEX account_provider_id_idx ON account(provider_id);
```

#### 4. verification è¡¨ (é‚®ç®±éªŒè¯)
```sql
CREATE TABLE verification (
  id TEXT PRIMARY KEY,                    -- éªŒè¯ID
  identifier TEXT NOT NULL,               -- éªŒè¯æ ‡è¯†ç¬¦
  value TEXT NOT NULL,                    -- éªŒè¯å€¼
  expires_at TIMESTAMP NOT NULL,          -- è¿‡æœŸæ—¶é—´
  created_at TIMESTAMP,                   -- åˆ›å»ºæ—¶é—´
  updated_at TIMESTAMP                    -- æ›´æ–°æ—¶é—´
);
```

## å‰ç«¯ç»„ä»¶è¯¦ç»†åˆ†æ

### 1. æ³¨å†Œè¡¨å•ç»„ä»¶ (RegisterForm)

#### ç»„ä»¶ä½ç½®
`src/components/auth/register-form.tsx`

#### æ ¸å¿ƒåŠŸèƒ½
- ç”¨æˆ·ä¿¡æ¯æ”¶é›†ï¼ˆå§“åã€é‚®ç®±ã€å¯†ç ï¼‰
- è¡¨å•éªŒè¯å’Œé”™è¯¯å¤„ç†
- éªŒè¯ç é›†æˆï¼ˆTurnstileï¼‰
- å›½é™…åŒ–æ”¯æŒ

#### è¡¨å•éªŒè¯è§„åˆ™
```typescript
const RegisterSchema = z.object({
  email: z.email({
    message: t('emailRequired'),
  }),
  password: z.string().min(1, {
    message: t('passwordRequired'),
  }),
  name: z.string().min(1, {
    message: t('nameRequired'),
  }),
  captchaToken: captchaSchema, // å¯é€‰ï¼Œæ ¹æ®é…ç½®å†³å®š
});
```

#### æäº¤æµç¨‹
```typescript
const onSubmit = async (values: z.infer<typeof RegisterSchema>) => {
  // 1. éªŒè¯ç æ ¡éªŒï¼ˆå¦‚æœå¯ç”¨ï¼‰
  if (captchaConfigured && values.captchaToken) {
    const captchaResult = await validateCaptchaAction({
      captchaToken: values.captchaToken,
    });

    if (!captchaResult?.data?.success) {
      setError(captchaResult?.data?.error || t('captchaInvalid'));
      return;
    }
  }

  // 2. è°ƒç”¨ Better Auth æ³¨å†Œæ¥å£
  await authClient.signUp.email({
    email: values.email,
    password: values.password,
    name: values.name,
    callbackURL: callbackUrl,
  }, {
    onRequest: (ctx) => {
      setIsPending(true);
      setError('');
      setSuccess('');
    },
    onSuccess: (ctx) => {
      setSuccess(t('checkEmail'));

      // é›†æˆç¬¬ä¸‰æ–¹æœåŠ¡ï¼ˆå¦‚ Affonso æ¨å¹¿ï¼‰
      if (websiteConfig.features.enableAffonsoAffiliate) {
        window.Affonso.signup(values.email);
      }
    },
    onError: (ctx) => {
      setError(`${ctx.error.status}: ${ctx.error.message}`);
      if (captchaConfigured) {
        resetCaptcha();
      }
    },
  });
};
```

### 2. ç™»å½•è¡¨å•ç»„ä»¶ (LoginForm)

#### ç»„ä»¶ä½ç½®
`src/components/auth/login-form.tsx`

#### æ ¸å¿ƒåŠŸèƒ½
- ç”¨æˆ·å‡­è¯éªŒè¯ï¼ˆé‚®ç®±ã€å¯†ç ï¼‰
- è®°ä½å¯†ç åŠŸèƒ½
- å¿˜è®°å¯†ç é“¾æ¥
- éªŒè¯ç é›†æˆ

#### è¡¨å•éªŒè¯è§„åˆ™
```typescript
const LoginSchema = z.object({
  email: z.email({
    message: t('emailRequired'),
  }),
  password: z.string().min(1, {
    message: t('passwordRequired'),
  }),
  captchaToken: captchaSchema,
});
```

#### æäº¤æµç¨‹
```typescript
const onSubmit = async (values: z.infer<typeof LoginSchema>) => {
  // 1. éªŒè¯ç æ ¡éªŒ
  if (captchaConfigured && values.captchaToken) {
    const captchaResult = await validateCaptchaAction({
      captchaToken: values.captchaToken,
    });

    if (!captchaResult?.data?.success) {
      setError(captchaResult?.data?.error || t('captchaInvalid'));
      return;
    }
  }

  // 2. è°ƒç”¨ Better Auth ç™»å½•æ¥å£
  await authClient.signIn.email({
    email: values.email,
    password: values.password,
    callbackURL: callbackUrl,
  }, {
    onRequest: (ctx) => {
      setIsPending(true);
      setError('');
      setSuccess('');
    },
    onSuccess: (ctx) => {
      // ç™»å½•æˆåŠŸï¼Œä¼šè‡ªåŠ¨é‡å®šå‘åˆ° callbackURL
    },
    onError: (ctx) => {
      setError(`${ctx.error.status}: ${ctx.error.message}`);
      if (captchaConfigured) {
        resetCaptcha();
      }
    },
  });
};
```

### 3. ç¤¾äº¤ç™»å½•ç»„ä»¶ (SocialLoginButton)

#### ç»„ä»¶ä½ç½®
`src/components/auth/social-login-button.tsx`

#### æ”¯æŒçš„æä¾›å•†
- **Google OAuth**: ä½¿ç”¨ Google è´¦å·ç™»å½•
- **GitHub OAuth**: ä½¿ç”¨ GitHub è´¦å·ç™»å½•

#### å®ç°é€»è¾‘
```typescript
const onClick = async (provider: 'google' | 'github') => {
  await authClient.signIn.social({
    provider: provider,
    callbackURL: callbackUrl,
    errorCallbackURL: Routes.AuthError,
  }, {
    onRequest: (ctx) => {
      setIsLoading(provider);
    },
    onSuccess: (ctx) => {
      setIsLoading(null);
      // ä¼šè‡ªåŠ¨é‡å®šå‘åˆ° callbackURL
    },
    onError: (ctx) => {
      console.log('social login error', ctx.error.message);
      setIsLoading(null);
    },
  });
};
```

## Better Auth é…ç½®è¯¦è§£

### 1. æ ¸å¿ƒé…ç½®æ–‡ä»¶
`src/lib/auth.ts`

### 2. åŸºç¡€é…ç½®
```typescript
export const auth = betterAuth({
  baseURL: getBaseUrl(),
  appName: defaultMessages.Metadata.name,
  database: drizzleAdapter(await getDb(), {
    provider: 'pg',
  }),

  // ä¼šè¯ç®¡ç†é…ç½®
  session: {
    cookieCache: {
      enabled: true,
      maxAge: 60 * 60, // 1å°æ—¶ç¼“å­˜
    },
    expiresIn: 60 * 60 * 24 * 7, // 7å¤©è¿‡æœŸ
    updateAge: 60 * 60 * 24, // 24å°æ—¶æ›´æ–°
    freshAge: 0, // ç¦ç”¨æ–°é²œåº¦æ£€æŸ¥
  },

  // é‚®ç®±å¯†ç ç™»å½•é…ç½®
  emailAndPassword: {
    enabled: true,
    requireEmailVerification: true, // å¿…é¡»éªŒè¯é‚®ç®±
    async sendResetPassword({ user, url }, request) {
      const locale = getLocaleFromRequest(request);
      const localizedUrl = getUrlWithLocaleInCallbackUrl(url, locale);

      await sendEmail({
        to: user.email,
        template: 'forgotPassword',
        context: { url: localizedUrl, name: user.name },
        locale,
      });
    },
  },

  // é‚®ç®±éªŒè¯é…ç½®
  emailVerification: {
    autoSignInAfterVerification: true, // éªŒè¯åè‡ªåŠ¨ç™»å½•
    sendVerificationEmail: async ({ user, url, token }, request) => {
      const locale = getLocaleFromRequest(request);
      const localizedUrl = getUrlWithLocaleInCallbackUrl(url, locale);

      await sendEmail({
        to: user.email,
        template: 'verifyEmail',
        context: { url: localizedUrl, name: user.name },
        locale,
      });
    },
  },

  // ç¤¾äº¤ç™»å½•é…ç½®
  socialProviders: {
    github: {
      clientId: process.env.GITHUB_CLIENT_ID!,
      clientSecret: process.env.GITHUB_CLIENT_SECRET!,
    },
    google: {
      clientId: process.env.GOOGLE_CLIENT_ID!,
      clientSecret: process.env.GOOGLE_CLIENT_SECRET!,
    },
  },

  // è´¦å·å…³è”é…ç½®
  account: {
    accountLinking: {
      enabled: true,
      trustedProviders: ['google', 'github'],
    },
  },

  // ç”¨æˆ·æ‰©å±•å­—æ®µ
  user: {
    additionalFields: {
      customerId: {
        type: 'string',
        required: false,
      },
    },
    deleteUser: {
      enabled: true,
    },
  },

  // æ•°æ®åº“é’©å­
  databaseHooks: {
    user: {
      create: {
        after: async (user) => {
          await onCreateUser(user); // ç”¨æˆ·åˆ›å»ºåçš„å¤„ç†
        },
      },
    },
  },

  // æ’ä»¶é…ç½®
  plugins: [
    admin({
      defaultBanExpiresIn: undefined,
      bannedUserMessage: 'You have been banned from this application.',
    }),
  ],

  // é”™è¯¯å¤„ç†
  onAPIError: {
    errorURL: '/auth/error',
    onError: (error, ctx) => {
      console.error('auth error:', error);
    },
  },
});
```

### 3. API è·¯ç”±å¤„ç†
`src/app/api/auth/[...all]/route.ts`

```typescript
import { auth } from '@/lib/auth';
import { toNextJsHandler } from 'better-auth/next-js';

export const { POST, GET } = toNextJsHandler(auth);
```

## ç”¨æˆ·åˆ›å»ºåå¤„ç†æµç¨‹

### 1. onCreateUser é’©å­å‡½æ•°

å½“ç”¨æˆ·æ³¨å†ŒæˆåŠŸåï¼ŒBetter Auth ä¼šè‡ªåŠ¨è°ƒç”¨ `onCreateUser` é’©å­å‡½æ•°ï¼Œæ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š

#### 1.1 æ–°é—»è®¢é˜…å¤„ç†
```typescript
// è‡ªåŠ¨è®¢é˜…æ–°é—»ï¼ˆå¦‚æœå¯ç”¨ï¼‰
if (
  user.email &&
  websiteConfig.newsletter.enable &&
  websiteConfig.newsletter.autoSubscribeAfterSignUp
) {
  // å»¶è¿Ÿ2ç§’é¿å…é‚®ä»¶å‘é€é¢‘ç‡é™åˆ¶
  setTimeout(async () => {
    try {
      const subscribed = await subscribe(user.email);
      if (!subscribed) {
        console.error(`Failed to subscribe user ${user.email} to newsletter`);
      } else {
        console.log(`User ${user.email} subscribed to newsletter`);
      }
    } catch (error) {
      console.error('Newsletter subscription error:', error);
    }
  }, 2000);
}
```

#### 1.2 æ³¨å†Œèµ é€ç§¯åˆ†
```typescript
// æ³¨å†Œèµ é€ç§¯åˆ†ï¼ˆå¦‚æœå¯ç”¨ï¼‰
if (
  websiteConfig.credits.enableCredits &&
  websiteConfig.credits.registerGiftCredits.enable &&
  websiteConfig.credits.registerGiftCredits.amount > 0
) {
  try {
    await addRegisterGiftCredits(user.id);
    console.log(`added register gift credits for user ${user.id}`);
  } catch (error) {
    console.error('Register gift credits error:', error);
  }
}
```

#### 1.3 å…è´¹æœˆåº¦ç§¯åˆ†
```typescript
// å…è´¹æœˆåº¦ç§¯åˆ†ï¼ˆå¦‚æœæœ‰å…è´¹è®¡åˆ’ï¼‰
if (websiteConfig.credits.enableCredits) {
  const pricePlans = getAllPricePlans();
  const freePlan = pricePlans.find(
    (plan) => plan.isFree && !plan.disabled && plan.credits?.enable
  );

  if (freePlan) {
    try {
      await addMonthlyFreeCredits(user.id, freePlan.id);
      console.log(`added Free monthly credits for user ${user.id}`);
    } catch (error) {
      console.error('Free monthly credits error:', error);
    }
  }
}
```

### 2. ç§¯åˆ†ç³»ç»Ÿé›†æˆ

#### 2.1 æ³¨å†Œèµ é€ç§¯åˆ†å®ç°
`src/credits/credits.ts` - `addRegisterGiftCredits` å‡½æ•°

```typescript
export async function addRegisterGiftCredits(userId: string) {
  // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç»è·å¾—æ³¨å†Œèµ é€ç§¯åˆ†
  const db = await getDb();
  const record = await db
    .select()
    .from(creditTransaction)
    .where(
      and(
        eq(creditTransaction.userId, userId),
        eq(creditTransaction.type, CREDIT_TRANSACTION_TYPE.REGISTER_GIFT)
      )
    )
    .limit(1);

  // å¦‚æœç”¨æˆ·è¿˜æ²¡æœ‰è·å¾—èµ é€ç§¯åˆ†ï¼Œåˆ™æ·»åŠ 
  if (record.length === 0) {
    const credits = websiteConfig.credits.registerGiftCredits.amount;
    const expireDays = websiteConfig.credits.registerGiftCredits.expireDays;

    await addCredits({
      userId,
      amount: credits,
      type: CREDIT_TRANSACTION_TYPE.REGISTER_GIFT,
      description: `Register gift credits: ${credits}`,
      expireDays,
    });

    console.log(`addRegisterGiftCredits, ${credits} credits for user ${userId}`);
  }
}
```

#### 2.2 ç§¯åˆ†æ·»åŠ æ ¸å¿ƒé€»è¾‘
```typescript
export async function addCredits({
  userId,
  amount,
  type,
  description,
  paymentId,
  expireDays,
}: {
  userId: string;
  amount: number;
  type: string;
  description: string;
  paymentId?: string;
  expireDays?: number;
}) {
  // å‚æ•°éªŒè¯
  if (!userId || !type || !description) {
    throw new Error('Invalid params');
  }
  if (!Number.isFinite(amount) || amount <= 0) {
    throw new Error('Invalid amount');
  }

  // æ›´æ–°ç”¨æˆ·ç§¯åˆ†ä½™é¢
  const db = await getDb();
  const current = await db
    .select()
    .from(userCredit)
    .where(eq(userCredit.userId, userId))
    .limit(1);

  if (current.length > 0) {
    // æ›´æ–°ç°æœ‰è®°å½•
    const newBalance = (current[0]?.currentCredits || 0) + amount;
    await db
      .update(userCredit)
      .set({
        currentCredits: newBalance,
        updatedAt: new Date(),
      })
      .where(eq(userCredit.userId, userId));
  } else {
    // åˆ›å»ºæ–°è®°å½•
    const newBalance = amount;
    await db.insert(userCredit).values({
      id: randomUUID(),
      userId,
      currentCredits: newBalance,
      createdAt: new Date(),
      updatedAt: new Date(),
    });
  }

  // è®°å½•ç§¯åˆ†äº¤æ˜“
  await saveCreditTransaction({
    userId,
    type,
    amount,
    description,
    paymentId,
    expirationDate: expireDays ? addDays(new Date(), expireDays) : undefined,
  });
}
```

### 3. æ–°é—»è®¢é˜…ç³»ç»Ÿ

#### 3.1 è®¢é˜…é€»è¾‘
`src/newsletter/index.ts` - `subscribe` å‡½æ•°

```typescript
export const subscribe = async (email: string): Promise<boolean> => {
  const provider = getNewsletterProvider();
  return provider.subscribe({ email });
};
```

#### 3.2 Resend æä¾›å•†å®ç°
`src/newsletter/provider/resend.ts`

```typescript
export class ResendNewsletterProvider implements NewsletterProvider {
  private resend: Resend;
  private audienceId: string;

  constructor() {
    const apiKey = process.env.RESEND_API_KEY;
    const audienceId = process.env.RESEND_AUDIENCE_ID;

    if (!apiKey || !audienceId) {
      throw new Error('Resend configuration missing');
    }

    this.resend = new Resend(apiKey);
    this.audienceId = audienceId;
  }

  async subscribe({ email }: { email: string }): Promise<boolean> {
    try {
      const response = await this.resend.contacts.create({
        audienceId: this.audienceId,
        email: email,
        unsubscribed: false,
      });

      return !!response.data;
    } catch (error) {
      console.error('Resend newsletter subscription error:', error);
      return false;
    }
  }
}
```

## é‚®ä»¶ç³»ç»Ÿè¯¦è§£

### 1. é‚®ä»¶å‘é€æ ¸å¿ƒé€»è¾‘
`src/mail/index.ts`

### 2. é‚®ç®±éªŒè¯é‚®ä»¶æ¨¡æ¿
`src/mail/templates/verify-email.tsx`

```typescript
export default function VerifyEmail({
  url,
  name,
  locale,
  messages,
}: VerifyEmailProps) {
  const t = createTranslator({
    locale,
    messages,
    namespace: 'Mail.verifyEmail',
  });

  return (
    <EmailLayout locale={locale} messages={messages}>
      <Text>{t('title', { name })}</Text>
      <Text>{t('body')}</Text>
      <EmailButton href={url}>{t('confirmEmail')}</EmailButton>
    </EmailLayout>
  );
}
```

### 3. å¿˜è®°å¯†ç é‚®ä»¶æ¨¡æ¿
`src/mail/templates/forgot-password.tsx`

```typescript
export default function ForgotPassword({
  url,
  name,
  locale,
  messages,
}: ForgotPasswordProps) {
  const t = createTranslator({
    locale,
    messages,
    namespace: 'Mail.forgotPassword',
  });

  return (
    <EmailLayout locale={locale} messages={messages}>
      <Text>{t('title', { name })}</Text>
      <Text>{t('body')}</Text>
      <EmailButton href={url}>{t('resetPassword')}</EmailButton>
    </EmailLayout>
  );
}
```

### 4. é‚®ä»¶å‘é€æµç¨‹
```typescript
export async function sendEmail(
  params: SendTemplateParams | SendRawEmailParams
) {
  const provider = getMailProvider();

  if ('template' in params) {
    // æ¨¡æ¿é‚®ä»¶
    const result = await provider.sendTemplate(params);
    return result.success;
  }
  // åŸå§‹é‚®ä»¶
  const result = await provider.sendRawEmail(params);
  return result.success;
}
```

## å®‰å…¨æœºåˆ¶

### 1. éªŒè¯ç ä¿æŠ¤ (Turnstile)

#### é…ç½®æ£€æŸ¥
```typescript
const turnstileEnabled = websiteConfig.features.enableTurnstileCaptcha;
const captchaSiteKey = process.env.NEXT_PUBLIC_TURNSTILE_SITE_KEY;
const captchaConfigured = turnstileEnabled && !!captchaSiteKey;
```

#### éªŒè¯é€»è¾‘
```typescript
// å‰ç«¯éªŒè¯ç ç»„ä»¶
<Captcha
  ref={captchaRef}
  onSuccess={(token) => form.setValue('captchaToken', token)}
  validationError={form.formState.errors.captchaToken?.message}
/>

// åç«¯éªŒè¯
const captchaResult = await validateCaptchaAction({
  captchaToken: values.captchaToken,
});

if (!captchaResult?.data?.success || !captchaResult?.data?.valid) {
  setError(captchaResult?.data?.error || t('captchaInvalid'));
  return;
}
```

### 2. ä¼šè¯ç®¡ç†

#### ä¼šè¯é…ç½®
```typescript
session: {
  cookieCache: {
    enabled: true,
    maxAge: 60 * 60, // 1å°æ—¶ç¼“å­˜
  },
  expiresIn: 60 * 60 * 24 * 7, // 7å¤©è¿‡æœŸ
  updateAge: 60 * 60 * 24, // 24å°æ—¶æ›´æ–°
  freshAge: 0, // ç¦ç”¨æ–°é²œåº¦æ£€æŸ¥
},
```

#### ä¼šè¯æ•°æ®ç»“æ„
- **ä¼šè¯ID**: å”¯ä¸€æ ‡è¯†ç¬¦
- **ç”¨æˆ·ID**: å…³è”çš„ç”¨æˆ·
- **è¿‡æœŸæ—¶é—´**: è‡ªåŠ¨è¿‡æœŸæ¸…ç†
- **IPåœ°å€**: å®‰å…¨è¿½è¸ª
- **ç”¨æˆ·ä»£ç†**: è®¾å¤‡è¯†åˆ«

### 3. å¯†ç å®‰å…¨

#### å¯†ç å­˜å‚¨
- ä½¿ç”¨ Better Auth å†…ç½®çš„å®‰å…¨å“ˆå¸Œç®—æ³•
- ä¸åœ¨æ•°æ®åº“ä¸­æ˜æ–‡å­˜å‚¨å¯†ç 
- æ”¯æŒå¯†ç é‡ç½®åŠŸèƒ½

#### å¯†ç é‡ç½®æµç¨‹
1. ç”¨æˆ·è¾“å…¥é‚®ç®±åœ°å€
2. ç³»ç»Ÿç”Ÿæˆå®‰å…¨çš„é‡ç½®ä»¤ç‰Œ
3. å‘é€é‡ç½®é‚®ä»¶åˆ°ç”¨æˆ·é‚®ç®±
4. ç”¨æˆ·ç‚¹å‡»é‚®ä»¶ä¸­çš„é“¾æ¥
5. è¾“å…¥æ–°å¯†ç å®Œæˆé‡ç½®

## å›½é™…åŒ–æ”¯æŒ

### 1. å¤šè¯­è¨€ç•Œé¢

#### æ”¯æŒè¯­è¨€
- **è‹±è¯­ (en)**: é»˜è®¤è¯­è¨€
- **ä¸­æ–‡ (zh)**: ç®€ä½“ä¸­æ–‡

#### ç¿»è¯‘é”®å€¼å¯¹ç¤ºä¾‹
```json
{
  "AuthPage": {
    "login": {
      "welcomeBack": "Welcome back",
      "email": "Email",
      "password": "Password",
      "signIn": "Sign In",
      "forgotPassword": "Forgot password?",
      "emailRequired": "Email is required",
      "passwordRequired": "Password is required"
    },
    "register": {
      "createAccount": "Create an account",
      "name": "Name",
      "email": "Email",
      "password": "Password",
      "signUp": "Sign Up",
      "nameRequired": "Name is required",
      "checkEmail": "Check your email for verification"
    }
  }
}
```

### 2. å¤šè¯­è¨€é‚®ä»¶æ¨¡æ¿

#### é‚®ä»¶æ¨¡æ¿å›½é™…åŒ–
```typescript
const t = createTranslator({
  locale,
  messages,
  namespace: 'Mail.verifyEmail',
});

// ä½¿ç”¨ç¿»è¯‘
<Text>{t('title', { name })}</Text>
<Text>{t('body')}</Text>
<EmailButton href={url}>{t('confirmEmail')}</EmailButton>
```

#### é‚®ä»¶ä¸»é¢˜å›½é™…åŒ–
```typescript
const subject =
  'subject' in messages.Mail[template as keyof Messages['Mail']]
    ? messages.Mail[template].subject
    : '';
```

## å®Œæ•´æµç¨‹å›¾ (å«å…·ä½“APIè°ƒç”¨)

### 1. ç”¨æˆ·æ³¨å†Œæµç¨‹

```
ç”¨æˆ·è®¿é—®æ³¨å†Œé¡µé¢ (/auth/register)
         â†“
å¡«å†™æ³¨å†Œè¡¨å• (å§“åã€é‚®ç®±ã€å¯†ç )
         â†“
å‰ç«¯è¡¨å•éªŒè¯ (Zod Schema)
  â”œâ”€â”€ zodResolver(RegisterSchema)
  â””â”€â”€ form.handleSubmit(onSubmit)
         â†“
éªŒè¯ç æ£€æŸ¥ (å¦‚æœå¯ç”¨)
  â””â”€â”€ validateCaptchaAction({ captchaToken })
         â†“
è°ƒç”¨ Better Auth å®¢æˆ·ç«¯æ–¹æ³•
  â””â”€â”€ authClient.signUp.email({
        email, password, name, callbackURL
      })
         â†“ HTTP POST è¯·æ±‚
Better Auth API è·¯ç”±å¤„ç†
  â””â”€â”€ POST /api/auth/sign-up/email
         â†“
Better Auth æœåŠ¡ç«¯å¤„ç†æ³¨å†Œè¯·æ±‚
  â”œâ”€â”€ éªŒè¯ç”¨æˆ·è¾“å…¥
  â”œâ”€â”€ æ£€æŸ¥é‚®ç®±æ˜¯å¦å·²å­˜åœ¨
  â”œâ”€â”€ ç”Ÿæˆç”¨æˆ·ID (randomUUID)
  â”œâ”€â”€ å“ˆå¸Œå¯†ç  (å†…ç½®åŠ å¯†ç®—æ³•)
  â””â”€â”€ åˆ›å»ºç”¨æˆ·è®°å½•
         â†“
æ•°æ®åº“æ“ä½œ (Drizzle ORM)
  â””â”€â”€ db.insert(user).values({
        id, name, email, password,
        emailVerified: false,
        createdAt, updatedAt
      })
         â†“
è§¦å‘æ•°æ®åº“é’©å­
  â””â”€â”€ databaseHooks.user.create.after(user)
         â†“
æ‰§è¡Œ onCreateUser é’©å­å‡½æ•°
  â”œâ”€â”€ è‡ªåŠ¨è®¢é˜…æ–°é—» (å»¶è¿Ÿ2ç§’)
  â”‚   â””â”€â”€ setTimeout(() => subscribe(email), 2000)
  â”‚       â””â”€â”€ resend.contacts.create({ audienceId, email })
  â”œâ”€â”€ æ·»åŠ æ³¨å†Œèµ é€ç§¯åˆ†
  â”‚   â””â”€â”€ addRegisterGiftCredits(userId)
  â”‚       â”œâ”€â”€ db.select().from(creditTransaction)
  â”‚       â”œâ”€â”€ addCredits({ userId, amount, type })
  â”‚       â”œâ”€â”€ db.insert(userCredit).values({ userId, credits })
  â”‚       â””â”€â”€ saveCreditTransaction({ userId, type, amount })
  â””â”€â”€ æ·»åŠ å…è´¹æœˆåº¦ç§¯åˆ†
      â””â”€â”€ addMonthlyFreeCredits(userId, planId)
         â†“
ç”Ÿæˆé‚®ç®±éªŒè¯ä»¤ç‰Œ
  â”œâ”€â”€ ç”ŸæˆéªŒè¯ä»¤ç‰Œ (crypto.randomBytes)
  â”œâ”€â”€ è®¾ç½®è¿‡æœŸæ—¶é—´ (24å°æ—¶)
  â””â”€â”€ å­˜å‚¨åˆ° verification è¡¨
         â†“
å‘é€é‚®ç®±éªŒè¯é‚®ä»¶
  â””â”€â”€ emailVerification.sendVerificationEmail()
      â”œâ”€â”€ getLocaleFromRequest(request)
      â”œâ”€â”€ getUrlWithLocaleInCallbackUrl(url, locale)
      â””â”€â”€ sendEmail({
            to: user.email,
            template: 'verifyEmail',
            context: { url, name },
            locale
          })
              â”œâ”€â”€ getTemplate({ template, context, locale })
              â”œâ”€â”€ render(email) // React Email
              â””â”€â”€ resend.emails.send({ to, subject, html })
         â†“
è¿”å›æˆåŠŸå“åº”ç»™å‰ç«¯
  â””â”€â”€ { success: true, data: { user } }
         â†“
å‰ç«¯æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
  â””â”€â”€ setSuccess(t('checkEmail'))
         â†“
ç”¨æˆ·æ”¶åˆ°éªŒè¯é‚®ä»¶
         â†“
ç‚¹å‡»é‚®ä»¶ä¸­çš„éªŒè¯é“¾æ¥
  â””â”€â”€ GET /api/auth/verify-email?token=xxx&callbackURL=xxx
         â†“
Better Auth éªŒè¯é‚®ä»¶ä»¤ç‰Œ
  â”œâ”€â”€ ä» verification è¡¨æŸ¥æ‰¾ä»¤ç‰Œ
  â”œâ”€â”€ æ£€æŸ¥ä»¤ç‰Œæ˜¯å¦è¿‡æœŸ
  â”œâ”€â”€ éªŒè¯ä»¤ç‰Œæœ‰æ•ˆæ€§
  â””â”€â”€ æ›´æ–°ç”¨æˆ· emailVerified = true
         â†“
è‡ªåŠ¨ç™»å½• (å¦‚æœå¯ç”¨)
  â”œâ”€â”€ åˆ›å»ºç”¨æˆ·ä¼šè¯
  â”œâ”€â”€ ç”Ÿæˆä¼šè¯ä»¤ç‰Œ
  â”œâ”€â”€ å­˜å‚¨åˆ° session è¡¨
  â””â”€â”€ è®¾ç½®ä¼šè¯ Cookie
         â†“
é‡å®šå‘åˆ°ä»ªè¡¨æ¿
  â””â”€â”€ redirect(callbackURL || '/dashboard')
```

### 2. ç”¨æˆ·ç™»å½•æµç¨‹

```
ç”¨æˆ·è®¿é—®ç™»å½•é¡µé¢ (/auth/login)
         â†“
å¡«å†™ç™»å½•è¡¨å• (é‚®ç®±ã€å¯†ç )
         â†“
å‰ç«¯è¡¨å•éªŒè¯ (Zod Schema)
  â”œâ”€â”€ zodResolver(LoginSchema)
  â””â”€â”€ form.handleSubmit(onSubmit)
         â†“
éªŒè¯ç æ£€æŸ¥ (å¦‚æœå¯ç”¨)
  â””â”€â”€ validateCaptchaAction({ captchaToken })
         â†“
è°ƒç”¨ Better Auth å®¢æˆ·ç«¯æ–¹æ³•
  â””â”€â”€ authClient.signIn.email({
        email, password, callbackURL
      })
         â†“ HTTP POST è¯·æ±‚
Better Auth API è·¯ç”±å¤„ç†
  â””â”€â”€ POST /api/auth/sign-in/email
         â†“
Better Auth æœåŠ¡ç«¯éªŒè¯ç”¨æˆ·å‡­è¯
  â”œâ”€â”€ ä» user è¡¨æŸ¥æ‰¾ç”¨æˆ· (by email)
  â”œâ”€â”€ éªŒè¯å¯†ç å“ˆå¸Œ (compare hash)
  â”œâ”€â”€ æ£€æŸ¥ç”¨æˆ·çŠ¶æ€ (banned, active)
  â””â”€â”€ éªŒè¯é‚®ç®±æ˜¯å¦å·²éªŒè¯
         â†“
æ£€æŸ¥é‚®ç®±éªŒè¯çŠ¶æ€
  â”œâ”€â”€ å¦‚æœæœªéªŒè¯ emailVerified = false
  â”‚   â”œâ”€â”€ é‡æ–°ç”ŸæˆéªŒè¯ä»¤ç‰Œ
  â”‚   â”œâ”€â”€ å‘é€æ–°çš„éªŒè¯é‚®ä»¶
  â”‚   â””â”€â”€ è¿”å›é”™è¯¯ "Email not verified"
  â””â”€â”€ å¦‚æœå·²éªŒè¯ emailVerified = true
      â””â”€â”€ ç»§ç»­ç™»å½•æµç¨‹
         â†“
åˆ›å»ºç”¨æˆ·ä¼šè¯
  â”œâ”€â”€ ç”Ÿæˆä¼šè¯IDå’Œä»¤ç‰Œ
  â”œâ”€â”€ è®¾ç½®è¿‡æœŸæ—¶é—´ (7å¤©å)
  â”œâ”€â”€ è®°å½•IPåœ°å€å’ŒUser-Agent
  â””â”€â”€ å­˜å‚¨åˆ° session è¡¨
      â””â”€â”€ db.insert(session).values({
            id, token, userId, expiresAt,
            ipAddress, userAgent, createdAt
          })
         â†“
è®¾ç½®ä¼šè¯Cookie
  â”œâ”€â”€ è®¾ç½® httpOnly Cookie
  â”œâ”€â”€ è®¾ç½® secure æ ‡å¿— (HTTPS)
  â”œâ”€â”€ è®¾ç½® sameSite å±æ€§
  â””â”€â”€ å¯ç”¨ cookieCache (1å°æ—¶)
         â†“
è¿”å›æˆåŠŸå“åº”
  â””â”€â”€ { success: true, data: { user, session } }
         â†“
å‰ç«¯è‡ªåŠ¨é‡å®šå‘
  â””â”€â”€ window.location.href = callbackURL || '/dashboard'
```

### 3. ç¤¾äº¤ç™»å½•æµç¨‹ (Google/GitHub)

```
ç”¨æˆ·ç‚¹å‡»ç¤¾äº¤ç™»å½•æŒ‰é’®
         â†“
è°ƒç”¨ Better Auth å®¢æˆ·ç«¯æ–¹æ³•
  â””â”€â”€ authClient.signIn.social({
        provider: 'google' | 'github',
        callbackURL,
        errorCallbackURL
      })
         â†“ HTTP GET è¯·æ±‚
Better Auth API è·¯ç”±å¤„ç†
  â””â”€â”€ GET /api/auth/sign-in/social/google
         â†“
Better Auth æ„å»ºOAuthæˆæƒURL
  â”œâ”€â”€ ç”Ÿæˆ state å‚æ•° (CSRFä¿æŠ¤)
  â”œâ”€â”€ ç”Ÿæˆ code_verifier (PKCE)
  â”œâ”€â”€ æ„å»ºæˆæƒURL
  â”‚   â”œâ”€â”€ Google: https://accounts.google.com/oauth/authorize
  â”‚   â””â”€â”€ GitHub: https://github.com/login/oauth/authorize
  â””â”€â”€ æ·»åŠ å‚æ•°: client_id, redirect_uri, scope, state
         â†“
é‡å®šå‘åˆ°ç¬¬ä¸‰æ–¹OAuthé¡µé¢
  â””â”€â”€ redirect(authorizationURL)
         â†“
ç”¨æˆ·åœ¨ç¬¬ä¸‰æ–¹é¡µé¢æˆæƒåº”ç”¨è®¿é—®
         â†“
ç¬¬ä¸‰æ–¹å›è°ƒåˆ°åº”ç”¨
  â””â”€â”€ GET /api/auth/callback/google?code=xxx&state=xxx
         â†“
Better Auth å¤„ç†OAuthå›è°ƒ
  â”œâ”€â”€ éªŒè¯ state å‚æ•° (é˜²CSRFæ”»å‡»)
  â”œâ”€â”€ ä½¿ç”¨ code æ¢å– access_token
  â”‚   â””â”€â”€ POST https://oauth2.googleapis.com/token
  â”œâ”€â”€ ä½¿ç”¨ access_token è·å–ç”¨æˆ·ä¿¡æ¯
  â”‚   â””â”€â”€ GET https://www.googleapis.com/oauth2/v2/userinfo
  â””â”€â”€ è§£æç”¨æˆ·æ•°æ® { id, email, name, picture }
         â†“
æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²å­˜åœ¨
  â”œâ”€â”€ æŸ¥æ‰¾ç°æœ‰ç”¨æˆ· (by email)
  â”œâ”€â”€ æ£€æŸ¥æ˜¯å¦æœ‰å…³è”çš„ç¬¬ä¸‰æ–¹è´¦å·
  â””â”€â”€ åˆ¤æ–­æ˜¯æ–°ç”¨æˆ·è¿˜æ˜¯è€ç”¨æˆ·
         â†“
ç”¨æˆ·å¤„ç†åˆ†æ”¯
  â”œâ”€â”€ æ–°ç”¨æˆ·: åˆ›å»ºè´¦å·æµç¨‹
  â”‚   â”œâ”€â”€ ç”Ÿæˆç”¨æˆ·ID
  â”‚   â”œâ”€â”€ åˆ›å»º user è®°å½•
  â”‚   â”‚   â””â”€â”€ db.insert(user).values({
  â”‚   â”‚         id, name, email, image,
  â”‚   â”‚         emailVerified: true, // ç¤¾äº¤ç™»å½•é»˜è®¤å·²éªŒè¯
  â”‚   â”‚         createdAt, updatedAt
  â”‚   â”‚       })
  â”‚   â”œâ”€â”€ åˆ›å»º account å…³è”è®°å½•
  â”‚   â”‚   â””â”€â”€ db.insert(account).values({
  â”‚   â”‚         id, accountId, providerId,
  â”‚   â”‚         userId, accessToken, refreshToken,
  â”‚   â”‚         scope, createdAt, updatedAt
  â”‚   â”‚       })
  â”‚   â””â”€â”€ è§¦å‘ onCreateUser é’©å­
  â”‚       â”œâ”€â”€ è‡ªåŠ¨è®¢é˜…æ–°é—»
  â”‚       â”œâ”€â”€ æ·»åŠ æ³¨å†Œèµ é€ç§¯åˆ†
  â”‚       â””â”€â”€ æ·»åŠ å…è´¹æœˆåº¦ç§¯åˆ†
  â””â”€â”€ è€ç”¨æˆ·: è´¦å·å…³è”æµç¨‹
      â”œâ”€â”€ æ£€æŸ¥æ˜¯å¦å·²å…³è”æ­¤æä¾›å•†
      â”œâ”€â”€ å¦‚æœæœªå…³è”ï¼Œåˆ›å»ºæ–°çš„ account è®°å½•
      â””â”€â”€ æ›´æ–° access_token å’Œ refresh_token
         â†“
åˆ›å»ºç”¨æˆ·ä¼šè¯ (åŒé‚®ç®±ç™»å½•)
  â”œâ”€â”€ ç”Ÿæˆä¼šè¯IDå’Œä»¤ç‰Œ
  â”œâ”€â”€ å­˜å‚¨åˆ° session è¡¨
  â””â”€â”€ è®¾ç½®ä¼šè¯Cookie
         â†“
é‡å®šå‘åˆ°æŒ‡å®šé¡µé¢
  â””â”€â”€ redirect(callbackURL || '/dashboard')
```

### 4. é‚®ç®±éªŒè¯æµç¨‹

```
ç”¨æˆ·ç‚¹å‡»é‚®ä»¶ä¸­çš„éªŒè¯é“¾æ¥
  â””â”€â”€ GET /api/auth/verify-email?token=xxx&callbackURL=xxx
         â†“
Better Auth API è·¯ç”±å¤„ç†
  â””â”€â”€ GET /api/auth/verify-email
         â†“
éªŒè¯ä»¤ç‰Œæœ‰æ•ˆæ€§
  â”œâ”€â”€ ä» verification è¡¨æŸ¥æ‰¾ä»¤ç‰Œ
  â”‚   â””â”€â”€ db.select().from(verification)
  â”‚       .where(eq(verification.value, token))
  â”œâ”€â”€ æ£€æŸ¥ä»¤ç‰Œæ˜¯å¦å­˜åœ¨
  â”œâ”€â”€ æ£€æŸ¥ä»¤ç‰Œæ˜¯å¦è¿‡æœŸ
  â”‚   â””â”€â”€ isAfter(new Date(), verification.expiresAt)
  â””â”€â”€ éªŒè¯ identifier (email) åŒ¹é…
         â†“
æ›´æ–°ç”¨æˆ·é‚®ç®±éªŒè¯çŠ¶æ€
  â”œâ”€â”€ æ›´æ–° user è¡¨
  â”‚   â””â”€â”€ db.update(user)
  â”‚       .set({ emailVerified: true, updatedAt: new Date() })
  â”‚       .where(eq(user.email, identifier))
  â””â”€â”€ åˆ é™¤å·²ä½¿ç”¨çš„éªŒè¯ä»¤ç‰Œ
      â””â”€â”€ db.delete(verification)
          .where(eq(verification.id, verificationId))
         â†“
è‡ªåŠ¨ç™»å½• (å¦‚æœå¯ç”¨)
  â”œâ”€â”€ autoSignInAfterVerification: true
  â”œâ”€â”€ åˆ›å»ºç”¨æˆ·ä¼šè¯
  â”œâ”€â”€ ç”Ÿæˆä¼šè¯ä»¤ç‰Œ
  â”œâ”€â”€ å­˜å‚¨åˆ° session è¡¨
  â””â”€â”€ è®¾ç½®ä¼šè¯Cookie
         â†“
é‡å®šå‘åˆ°æŒ‡å®šé¡µé¢
  â””â”€â”€ redirect(callbackURL || '/dashboard')
```

### 5. å¯†ç é‡ç½®æµç¨‹

```
ç”¨æˆ·è®¿é—®å¿˜è®°å¯†ç é¡µé¢
  â””â”€â”€ /auth/forgot-password
         â†“
è¾“å…¥é‚®ç®±åœ°å€å¹¶æäº¤
         â†“
è°ƒç”¨ Better Auth å®¢æˆ·ç«¯æ–¹æ³•
  â””â”€â”€ authClient.forgetPassword({ email })
         â†“ HTTP POST è¯·æ±‚
Better Auth API è·¯ç”±å¤„ç†
  â””â”€â”€ POST /api/auth/forget-password
         â†“
éªŒè¯é‚®ç®±æ˜¯å¦å­˜åœ¨
  â”œâ”€â”€ ä» user è¡¨æŸ¥æ‰¾ç”¨æˆ·
  â”‚   â””â”€â”€ db.select().from(user)
  â”‚       .where(eq(user.email, email))
  â””â”€â”€ å¦‚æœç”¨æˆ·ä¸å­˜åœ¨ï¼Œè¿”å›é€šç”¨æˆåŠŸæ¶ˆæ¯ (å®‰å…¨è€ƒè™‘)
         â†“
ç”Ÿæˆå¯†ç é‡ç½®ä»¤ç‰Œ
  â”œâ”€â”€ ç”Ÿæˆé‡ç½®ä»¤ç‰Œ (crypto.randomBytes)
  â”œâ”€â”€ è®¾ç½®è¿‡æœŸæ—¶é—´ (1å°æ—¶)
  â””â”€â”€ å­˜å‚¨åˆ° verification è¡¨
      â””â”€â”€ db.insert(verification).values({
            id, identifier: email, value: token,
            expiresAt, createdAt
          })
         â†“
å‘é€å¯†ç é‡ç½®é‚®ä»¶
  â””â”€â”€ emailAndPassword.sendResetPassword()
      â”œâ”€â”€ getLocaleFromRequest(request)
      â”œâ”€â”€ æ„å»ºé‡ç½®URL (å«token)
      â””â”€â”€ sendEmail({
            to: user.email,
            template: 'forgotPassword',
            context: { url, name },
            locale
          })
         â†“
ç”¨æˆ·æ”¶åˆ°é‡ç½®é‚®ä»¶å¹¶ç‚¹å‡»é“¾æ¥
  â””â”€â”€ GET /auth/reset-password?token=xxx
         â†“
éªŒè¯é‡ç½®ä»¤ç‰Œ
  â”œâ”€â”€ ä» verification è¡¨æŸ¥æ‰¾ä»¤ç‰Œ
  â”œâ”€â”€ æ£€æŸ¥ä»¤ç‰Œæ˜¯å¦æœ‰æ•ˆå’Œæœªè¿‡æœŸ
  â””â”€â”€ æ˜¾ç¤ºé‡ç½®å¯†ç è¡¨å•
         â†“
ç”¨æˆ·è¾“å…¥æ–°å¯†ç å¹¶æäº¤
         â†“
è°ƒç”¨ Better Auth é‡ç½®å¯†ç æ–¹æ³•
  â””â”€â”€ authClient.resetPassword({ token, password })
         â†“ HTTP POST è¯·æ±‚
Better Auth API è·¯ç”±å¤„ç†
  â””â”€â”€ POST /api/auth/reset-password
         â†“
éªŒè¯ä»¤ç‰Œå¹¶æ›´æ–°å¯†ç 
  â”œâ”€â”€ éªŒè¯é‡ç½®ä»¤ç‰Œæœ‰æ•ˆæ€§
  â”œâ”€â”€ å“ˆå¸Œæ–°å¯†ç 
  â”œâ”€â”€ æ›´æ–° user è¡¨ä¸­çš„å¯†ç 
  â”‚   â””â”€â”€ db.update(user)
  â”‚       .set({ password: hashedPassword, updatedAt })
  â”‚       .where(eq(user.email, identifier))
  â”œâ”€â”€ åˆ é™¤å·²ä½¿ç”¨çš„é‡ç½®ä»¤ç‰Œ
  â””â”€â”€ æ¸…é™¤æ‰€æœ‰ç°æœ‰ä¼šè¯ (å¼ºåˆ¶é‡æ–°ç™»å½•)
         â†“
è¿”å›æˆåŠŸå“åº”
         â†“
é‡å®šå‘åˆ°ç™»å½•é¡µé¢
  â””â”€â”€ redirect('/auth/login')
```

## é”™è¯¯å¤„ç†æœºåˆ¶

### 1. å‰ç«¯é”™è¯¯å¤„ç†

#### è¡¨å•éªŒè¯é”™è¯¯
```typescript
const form = useForm<z.infer<typeof RegisterSchema>>({
  resolver: zodResolver(RegisterSchema),
  defaultValues: {
    email: '',
    password: '',
    name: '',
    captchaToken: '',
  },
});

// æ˜¾ç¤ºå­—æ®µçº§é”™è¯¯
<FormMessage /> // è‡ªåŠ¨æ˜¾ç¤ºéªŒè¯é”™è¯¯
```

#### ç½‘ç»œè¯·æ±‚é”™è¯¯
```typescript
onError: (ctx) => {
  console.error('register, error:', ctx.error);
  setError(`${ctx.error.status}: ${ctx.error.message}`);

  // é‡ç½®éªŒè¯ç 
  if (captchaConfigured) {
    resetCaptcha();
  }
},
```

### 2. åç«¯é”™è¯¯å¤„ç†

#### Better Auth é”™è¯¯é…ç½®
```typescript
onAPIError: {
  errorURL: '/auth/error',
  onError: (error, ctx) => {
    console.error('auth error:', error);
  },
},
```

#### æ•°æ®åº“é”™è¯¯å¤„ç†
```typescript
try {
  await addRegisterGiftCredits(user.id);
  console.log(`added register gift credits for user ${user.id}`);
} catch (error) {
  console.error('Register gift credits error:', error);
  // ä¸ä¸­æ–­ä¸»æµç¨‹ï¼Œè®°å½•é”™è¯¯æ—¥å¿—
}
```

## æ€§èƒ½ä¼˜åŒ–

### 1. æ•°æ®åº“ä¼˜åŒ–

#### ç´¢å¼•ç­–ç•¥
```sql
-- ç”¨æˆ·è¡¨ç´¢å¼•
CREATE INDEX user_id_idx ON user(id);
CREATE INDEX user_customer_id_idx ON user(customer_id);
CREATE INDEX user_role_idx ON user(role);

-- ä¼šè¯è¡¨ç´¢å¼•
CREATE INDEX session_token_idx ON session(token);
CREATE INDEX session_user_id_idx ON session(user_id);

-- è´¦å·è¡¨ç´¢å¼•
CREATE INDEX account_user_id_idx ON account(user_id);
CREATE INDEX account_account_id_idx ON account(account_id);
CREATE INDEX account_provider_id_idx ON account(provider_id);
```

#### æŸ¥è¯¢ä¼˜åŒ–
```typescript
// åªæŸ¥è¯¢éœ€è¦çš„å­—æ®µ
const record = await db
  .select({ currentCredits: userCredit.currentCredits })
  .from(userCredit)
  .where(eq(userCredit.userId, userId))
  .limit(1);
```

### 2. å‰ç«¯ä¼˜åŒ–

#### ç»„ä»¶æ‡’åŠ è½½
```typescript
// æŒ‰éœ€åŠ è½½è®¤è¯ç»„ä»¶
const LoginForm = dynamic(() => import('@/components/auth/login-form'), {
  loading: () => <Skeleton />,
});
```

#### ä¼šè¯ç¼“å­˜
```typescript
session: {
  cookieCache: {
    enabled: true,
    maxAge: 60 * 60, // 1å°æ—¶ç¼“å­˜
  },
},
```

### 3. é‚®ä»¶å‘é€ä¼˜åŒ–

#### å¼‚æ­¥å¤„ç†
```typescript
// å»¶è¿Ÿå‘é€é¿å…é¢‘ç‡é™åˆ¶
setTimeout(async () => {
  try {
    const subscribed = await subscribe(user.email);
  } catch (error) {
    console.error('Newsletter subscription error:', error);
  }
}, 2000);
```

## ç›‘æ§å’Œæ—¥å¿—

### 1. ç”¨æˆ·è¡Œä¸ºè¿½è¸ª

#### ç™»å½•æ—¥å¿—
```typescript
onSuccess: (ctx) => {
  console.log("login, success:", ctx.data);
  // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ ç”¨æˆ·è¡Œä¸ºåˆ†æ
},
onError: (ctx) => {
  console.error('login, error:', ctx.error);
  // è®°å½•ç™»å½•å¤±è´¥äº‹ä»¶
},
```

#### æ³¨å†Œæ—¥å¿—
```typescript
onSuccess: (ctx) => {
  console.log("register, success:", ctx.data);
  // è®°å½•æ³¨å†ŒæˆåŠŸäº‹ä»¶

  // ç¬¬ä¸‰æ–¹åˆ†æé›†æˆ
  if (websiteConfig.features.enableAffonsoAffiliate) {
    window.Affonso.signup(values.email);
  }
},
```

### 2. ç³»ç»Ÿç›‘æ§

#### æ•°æ®åº“æ“ä½œæ—¥å¿—
```typescript
console.log('addCredits, update user credit', userId, newBalance);
console.log(`addRegisterGiftCredits, ${credits} credits for user ${userId}`);
```

#### é”™è¯¯ç›‘æ§
```typescript
onAPIError: {
  errorURL: '/auth/error',
  onError: (error, ctx) => {
    console.error('auth error:', error);
    // å¯ä»¥é›†æˆ Sentry ç­‰é”™è¯¯ç›‘æ§æœåŠ¡
  },
},
```

## æ‰©å±•å»ºè®®

### 1. å®‰å…¨å¢å¼º
- æ·»åŠ åŒå› ç´ è®¤è¯ (2FA)
- å®ç°è®¾å¤‡æŒ‡çº¹è¯†åˆ«
- æ·»åŠ ç™»å½•åœ°ç†ä½ç½®æ£€æµ‹
- å®ç°æš´åŠ›ç ´è§£ä¿æŠ¤

### 2. åŠŸèƒ½æ‰©å±•
- æ·»åŠ æ›´å¤šç¤¾äº¤ç™»å½•æä¾›å•†
- å®ç°å•ç‚¹ç™»å½• (SSO)
- æ·»åŠ ç”¨æˆ·é‚€è¯·ç³»ç»Ÿ
- å®ç°ç”¨æˆ·åˆ†ç»„ç®¡ç†

### 3. ç”¨æˆ·ä½“éªŒä¼˜åŒ–
- æ·»åŠ ç™»å½•çŠ¶æ€ä¿æŒé€‰é¡¹
- å®ç°æ— å¯†ç ç™»å½• (Magic Link)
- æ·»åŠ ç”¨æˆ·å¤´åƒä¸Šä¼ 
- ä¼˜åŒ–ç§»åŠ¨ç«¯ä½“éªŒ

### 4. æ•°æ®åˆ†æ
- ç”¨æˆ·æ³¨å†Œè½¬åŒ–ç‡åˆ†æ
- ç™»å½•æ–¹å¼åå¥½ç»Ÿè®¡
- ç”¨æˆ·æ´»è·ƒåº¦è¿½è¸ª
- é‚®ç®±éªŒè¯ç‡ç›‘æ§

## æ€»ç»“

MkSaaS Template çš„ç™»å½•æ³¨å†Œç³»ç»Ÿæ˜¯ä¸€ä¸ªåŠŸèƒ½å®Œæ•´ã€å®‰å…¨å¯é çš„ç°ä»£åŒ–è®¤è¯è§£å†³æ–¹æ¡ˆã€‚**Better Auth åœ¨å…¶ä¸­æ‰®æ¼”ç€è®¤è¯ä¸­å°çš„æ ¸å¿ƒè§’è‰²**ï¼Œå®ƒä¸ä»…æä¾›äº†åŸºç¡€çš„ç”¨æˆ·è®¤è¯åŠŸèƒ½ï¼Œè¿˜é€šè¿‡å…¶å¼ºå¤§çš„æ’ä»¶ç³»ç»Ÿå’Œé’©å­æœºåˆ¶ï¼Œæ— ç¼é›†æˆäº†ç§¯åˆ†ç³»ç»Ÿã€é‚®ä»¶ç³»ç»Ÿã€æ–°é—»è®¢é˜…ç­‰ä¸šåŠ¡åŠŸèƒ½ã€‚

### Better Auth çš„æ ¸å¿ƒä»·å€¼
1. **ç»Ÿä¸€è®¤è¯å…¥å£**: æä¾›æ ‡å‡†åŒ–çš„è®¤è¯APIï¼Œæ”¯æŒå¤šç§ç™»å½•æ–¹å¼
2. **å®‰å…¨ä¿éšœä¸­å¿ƒ**: å†…ç½®å¯†ç åŠ å¯†ã€ä¼šè¯ç®¡ç†ã€CSRFä¿æŠ¤ç­‰å®‰å…¨æœºåˆ¶
3. **ä¸šåŠ¡æµç¨‹ç¼–æ’**: é€šè¿‡é’©å­æœºåˆ¶å®ç°å¤æ‚ä¸šåŠ¡é€»è¾‘çš„è‡ªåŠ¨åŒ–å¤„ç†
4. **æ‰©å±•èƒ½åŠ›æä¾›**: æ’ä»¶ç³»ç»Ÿå’Œé€‚é…å™¨æ¨¡å¼æ”¯æŒåŠŸèƒ½æ‰©å±•å’Œå¤šç§æ•°æ®åº“

### ç³»ç»Ÿä¼˜åŠ¿
1. **æŠ€æœ¯å…ˆè¿›**: ä½¿ç”¨ Better Auth ç­‰ç°ä»£åŒ–æŠ€æœ¯æ ˆ
2. **åŠŸèƒ½å®Œæ•´**: æ¶µç›–æ³¨å†Œã€ç™»å½•ã€éªŒè¯ã€é‡ç½®ç­‰å…¨æµç¨‹
3. **å®‰å…¨å¯é **: å¤šå±‚å®‰å…¨é˜²æŠ¤æœºåˆ¶
4. **ç”¨æˆ·å‹å¥½**: ä¼˜ç§€çš„ç”¨æˆ·ä½“éªŒè®¾è®¡
5. **æ˜“äºæ‰©å±•**: æ¨¡å—åŒ–æ¶æ„ä¾¿äºåŠŸèƒ½æ‰©å±•

è¿™ä¸ªç³»ç»Ÿå¯ä»¥ä½œä¸ºå…¶ä»– SaaS é¡¹ç›®çš„å‚è€ƒå®ç°ï¼Œä¹Ÿå¯ä»¥æ ¹æ®å…·ä½“éœ€æ±‚è¿›è¡Œå®šåˆ¶åŒ–æ”¹é€ ã€‚
