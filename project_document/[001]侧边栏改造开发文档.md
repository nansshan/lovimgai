# [001] ä¾§è¾¹æ æ”¹é€ å¼€å‘æ–‡æ¡£ - AIå›¾ç‰‡ç¼–è¾‘ç•Œé¢

**ç”Ÿæˆæ—¶é—´:** 2025-09-13T23:22:08+08:00
**å¼€å‘ç›®æ ‡:** æ”¹é€ ç°æœ‰ä¾§è¾¹æ ï¼Œå®ç°AIå›¾ç‰‡ç”Ÿæˆå¯¹è¯ç³»ç»Ÿ
**å‚è€ƒç•Œé¢:** ç±»ä¼¼ChatGPT + DALL-Eçš„å›¾ç‰‡ç¼–è¾‘ç•Œé¢
**é¡¹ç›®åŸºç¡€:** åŸºäºMkSaaSé¡¹ç›®æ¶æ„ï¼Œå¤ç”¨ç°æœ‰è®¤è¯ã€ç§¯åˆ†ã€å­˜å‚¨ç³»ç»Ÿ

## ğŸ¯ éœ€æ±‚åˆ†æ

### æ ¸å¿ƒåŠŸèƒ½éœ€æ±‚
1. **æ–°å»ºä¼šè¯æŒ‰é’®** - ä½äºä¾§è¾¹æ é¡¶éƒ¨ï¼Œä½¿ç”¨RippleButtonåŠ¨ç”»æ•ˆæœ
2. **æ¨¡å¼åˆ‡æ¢æŒ‰é’®** - Chat/Canvasä¸¤ä¸ªåˆ‡æ¢æŒ‰é’®ï¼ŒCanvaså®Œå…¨ç¦ç”¨æ˜¾ç¤º"Coming Soon"
3. **Recent Editåˆ—è¡¨** - æ˜¾ç¤ºå‰5å­—ç¬¦+åˆ›å»ºæ—¶é—´ï¼Œç‚¹å‡»åˆ‡æ¢ä¼šè¯
4. **å¯¹è¯è¾“å…¥ç•Œé¢** - æ”¯æŒæ–‡å­—æè¿°å’Œå¤šå›¾ç‰‡ä¸Šä¼ ï¼ˆæœ€å¤§20MB/å¼ ï¼‰
5. **AIæ¨¡å‹é€‰æ‹©å™¨** - ä½äºè¾“å…¥æ¡†ä¸‹æ–¹ï¼ŒCursoræ ·å¼ï¼Œä»…æ˜¾ç¤ºæ¨¡å‹åç§°+ç§¯åˆ†æ¶ˆè€—
6. **å›¾ç‰‡é¢„è§ˆåŒºåŸŸ** - ä¸»å›¾85% + ç¼©ç•¥å›¾15%ï¼Œä»…æ˜¾ç¤ºå½“å‰ä¼šè¯å›¾ç‰‡
7. **å¼‚æ­¥ä»»åŠ¡å¤„ç†** - è½®è¯¢+Webhookæœºåˆ¶ï¼Œ40ç§’è¶…æ—¶

### ç•Œé¢å¸ƒå±€éœ€æ±‚

#### Chatæ¨¡å¼ (é»˜è®¤)
- **ä¾§è¾¹æ :** å›ºå®š256pxå®½åº¦
- **å¯¹è¯åŒºåŸŸ:** 50%å‰©ä½™ç©ºé—´ï¼Œæ”¯æŒæ–‡å­—+å›¾ç‰‡è¾“å…¥
- **å›¾ç‰‡é¢„è§ˆåŒºåŸŸ:** 50%å‰©ä½™ç©ºé—´ï¼Œä¸»å›¾é¢„è§ˆ+ç¼©ç•¥å›¾åˆ—è¡¨
- **æ¨¡å‹é€‰æ‹©å™¨:** ä½äºè¾“å…¥æ¡†ä¸‹æ–¹ï¼Œç±»ä¼¼Cursoræ ·å¼

#### Canvasæ¨¡å¼ (é¢„ç•™æ¶æ„)
- **æŒ‰é’®çŠ¶æ€:** å®Œå…¨ç¦ç”¨ï¼ˆç°è‰²ï¼‰ï¼Œæ˜¾ç¤º"Coming Soon"æç¤º
- **åŠŸèƒ½çŠ¶æ€:** æš‚ä¸å¼€å‘ï¼Œå¾…è®¾è®¡å®Œæ•´åå®ç°

## ğŸ“ ç•Œé¢å¸ƒå±€è®¾è®¡ (ASCII)

### Chatæ¨¡å¼å¸ƒå±€
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                           ä¸»ç•Œé¢                                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   ä¾§è¾¹æ         â”‚            Chatæ¨¡å¼ - å¯¹è¯ç•Œé¢åŒºåŸŸ (50%) â”‚         å›¾ç‰‡é¢„è§ˆåŒºåŸŸ (50%)               â”‚
â”‚   (å›ºå®š256px)   â”‚                                         â”‚                                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ New Edit    â”‚ â”‚ â”‚           å¯¹è¯è®°å½•å±•ç¤ºåŒº             â”‚ â”‚ â”‚           ä¸»å›¾ç‰‡é¢„è§ˆ                 â”‚ â”‚
â”‚ â”‚ (RippleBtn) â”‚ â”‚ â”‚                                     â”‚ â”‚ â”‚         (å é¢„è§ˆåŒº85%)               â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚ â”‚                                     â”‚ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â” â”‚ â”‚  â”‚   ç”¨æˆ·æ¶ˆæ¯      â”‚  â”‚   AI    â”‚  â”‚ â”‚ â”‚                                     â”‚ â”‚
â”‚ â”‚[Chat]â”‚Canvasâ”‚ â”‚ â”‚  â”‚    (å³ä¾§)      â”‚  â”‚  æ¶ˆæ¯   â”‚  â”‚ â”‚ â”‚                                     â”‚ â”‚
â”‚ â”‚ ğŸ”¥   â”‚Comingâ”‚ â”‚ â”‚  â”‚               â”‚  â”‚ (å·¦ä¾§)  â”‚  â”‚ â”‚ â”‚                                     â”‚ â”‚
â”‚ â”‚      â”‚ Soon â”‚ â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚                                     â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ Recent Edit     â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚         ç¼©ç•¥å›¾åˆ—è¡¨åŒº                 â”‚ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚            è¾“å…¥æ¡†åŒºåŸŸ                â”‚ â”‚ â”‚       (å é¢„è§ˆåŒº15%)                 â”‚ â”‚
â”‚ â”‚å‰5å­—ç¬¦+æ—¶é—´ â”‚ â”‚ â”‚ â”‚  [ğŸ“] [è¾“å…¥æ¡†..............] [å‘é€] â”‚ â”‚ â”‚ [img1] [img2] [img3] [img4] [img5] â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚                                     â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚   [ğŸ¤– Nano Banana - 8ç§¯åˆ†] â–¼      â”‚ â”‚                                         â”‚
â”‚ â”‚ä¼šè¯2        â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                                         â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ” ç»„ä»¶è®¾è®¡è¯¦æƒ…

### 1. PhotoEditorLayout (ä¸»å¸ƒå±€ç»„ä»¶)
```typescript
interface PhotoEditorLayoutProps {
  children: React.ReactNode;
}
// è´Ÿè´£æ•´ä½“ä¸‰æ å¸ƒå±€ï¼šä¾§è¾¹æ (256px) + å¯¹è¯åŒº(50%) + é¢„è§ˆåŒº(50%)
```

### 2. ModeToggle (æ¨¡å¼åˆ‡æ¢ç»„ä»¶)
```typescript
interface ModeToggleProps {
  currentMode: 'chat' | 'canvas';
  onModeChange: (mode: 'chat' | 'canvas') => void;
}
// ChatæŒ‰é’®: é»˜è®¤é«˜äº®ï¼Œæ˜¾ç¤ºå¯¹è¯ç•Œé¢
// CanvasæŒ‰é’®: å®Œå…¨ç¦ç”¨ï¼ˆç°è‰²ä¸å¯ç‚¹å‡»ï¼‰ï¼Œæ˜¾ç¤º"Coming Soon"æç¤ºæ ‡è¯†
```

### 3. PhotoEditorSidebar (å›¾ç‰‡ç¼–è¾‘ä¾§è¾¹æ )
```typescript
interface PhotoEditorSidebarProps {
  currentSessionId?: string;
  currentMode: 'chat' | 'canvas';
  onSessionChange: (sessionId: string) => void;
  onNewSession: () => void;
  onModeChange: (mode: 'chat' | 'canvas') => void;
}
// åŒ…å«ï¼šRippleButton(æ–°å»ºä¼šè¯) + ModeToggle(æ¨¡å¼åˆ‡æ¢) + RecentEditList(å†å²ä¼šè¯)
```

### 4. RecentEditList (å†å²ä¼šè¯åˆ—è¡¨)
```typescript
interface EditSession {
  id: string;
  title: string; // ç¬¬ä¸€æ¡promptçš„å‰5å­—ç¬¦
  createdAt: Date;
  firstPrompt: string; // å®Œæ•´çš„ç¬¬ä¸€æ¡promptï¼Œç”¨äºç”Ÿæˆtitle
}

interface RecentEditListProps {
  sessions: EditSession[];
  currentSessionId?: string;
  onSessionSelect: (sessionId: string) => void;
}
// å±•ç¤ºå†…å®¹ï¼šç¬¬ä¸€æ¡promptçš„å‰5å­—ç¬¦ + åˆ›å»ºæ—¶é—´
// ç‚¹å‡»è¡Œä¸ºï¼šåˆ‡æ¢åˆ°è¯¥ä¼šè¯
// ä¸æ˜¾ç¤ºï¼šä»»åŠ¡æ•°é‡ã€å›¾ç‰‡ç¼©ç•¥å›¾
```

### 5. ModelSelector (AIæ¨¡å‹é€‰æ‹©å™¨)
```typescript
interface ModelSelectorProps {
  selectedModel: string;
  onModelChange: (modelId: string) => void;
  userCredits: number;
}
// ä½ç½®ï¼šè¾“å…¥æ¡†ä¸‹æ–¹ï¼Œç±»ä¼¼Cursorçš„æ¨¡å‹é€‰æ‹©å™¨æ ·å¼
// æ˜¾ç¤ºå†…å®¹ï¼šä»…æ˜¾ç¤ºæ¨¡å‹åç§°å’Œç§¯åˆ†æ¶ˆè€—å€¼ï¼Œä¸æ˜¾ç¤ºèƒ½åŠ›æ ‡ç­¾
// ç§¯åˆ†å¤„ç†ï¼šç§¯åˆ†ä¸è¶³çš„æ¨¡å‹ä¸æ˜¾ç¤ºåœ¨é€‰æ‹©åˆ—è¡¨ä¸­
// é…ç½®ç®¡ç†ï¼šä½¿ç”¨ç‹¬ç«‹é…ç½®æ–‡ä»¶ src/config/ai-models-config.ts
```

### 6. ImagePreviewPanel (å›¾ç‰‡é¢„è§ˆé¢æ¿)
```typescript
interface ImagePreviewPanelProps {
  mainImage?: string;
  thumbnails: string[]; // å½“å‰ä¼šè¯çš„å†å²å›¾ç‰‡ï¼Œä¸æ˜¯ç”¨æˆ·æ‰€æœ‰å›¾ç‰‡
  onThumbnailClick: (imageUrl: string) => void;
  className?: string;
}
// å¸ƒå±€ç»“æ„ï¼šä¸»å›¾é¢„è§ˆåŒºåŸŸ85% + ç¼©ç•¥å›¾åˆ—è¡¨åŒºåŸŸ15%
// ç¼©ç•¥å›¾äº¤äº’ï¼šç‚¹å‡»åæ›¿æ¢ä¸»å›¾æ˜¾ç¤º
// åŠŸèƒ½é™åˆ¶ï¼šä¸éœ€è¦å›¾ç‰‡ä¸‹è½½/ä¿å­˜åŠŸèƒ½ï¼Œä¸æ”¯æŒå…¨å±æŸ¥çœ‹
// æ•°æ®èŒƒå›´ï¼šä»…æ˜¾ç¤ºå½“å‰ä¼šè¯çš„å›¾ç‰‡
```

### 7. ImageUploadInput (å›¾ç‰‡ä¸Šä¼ è¾“å…¥)
```typescript
interface ImageUploadInputProps {
  onTextSubmit: (text: string) => void;
  onImageUpload: (files: File[]) => void;
  onImageWithTextSubmit: (text: string, files: File[]) => void;
  isLoading?: boolean;
  maxImages?: number; // æœ€å¤§å›¾ç‰‡æ•°é‡é™åˆ¶
  maxSize?: number;   // å•å¼ å›¾ç‰‡æœ€å¤§å¤§å° (é»˜è®¤20MB)
}
// æ”¯æŒï¼šæ–‡æœ¬è¾“å…¥ + å¤šå›¾ç‰‡ä¸Šä¼  + ç»„åˆæäº¤
// é™åˆ¶ï¼šå•å¼ å›¾ç‰‡æœ€å¤§20MBï¼Œæ”¯æŒå¤šå¼ ä¸Šä¼ 
```

## ğŸ”§ æŠ€æœ¯å®ç°è¦ç‚¹

### 1. AIæ¨¡å‹é…ç½®ç®¡ç†
```typescript
// src/config/ai-models-config.ts
interface AIModel {
  id: string;
  name: string;
  provider: string;
  creditsPerUse: number;
  maxImages: number;
}

const AVAILABLE_MODELS: AIModel[] = [
  {
    id: 'google/nano-banana',
    name: 'Nano Banana',
    provider: 'Google',
    creditsPerUse: 8,
    maxImages: 1
  }
  // å…¶ä»–æ¨¡å‹æš‚ä¸é…ç½®ï¼Œå¾…åç»­éœ€è¦æ—¶æ·»åŠ 
];
```

### 2. çŠ¶æ€ç®¡ç† (Zustand)
```typescript
interface PhotoEditorStore {
  // ä¼šè¯ç®¡ç†
  currentSessionId: string | null;
  sessions: EditSession[];

  // å›¾ç‰‡ç®¡ç†
  currentImages: string[];
  selectedImageIndex: number;

  // UIçŠ¶æ€
  sidebarOpen: boolean;
  previewPanelOpen: boolean;

  // æ¨¡å¼ç®¡ç†
  currentMode: 'chat' | 'canvas';
}
```

### 3. æ•°æ®åº“è¡¨ç»“æ„æ‰©å±•
```sql
-- åŸºäºç°æœ‰MkSaaSé¡¹ç›®schemaæ‰©å±•

-- AIä¼šè¯è¡¨ (ai_photo_sessions) - æ–°å¢è¡¨
CREATE TABLE ai_photo_sessions (
  id TEXT PRIMARY KEY,
  user_id TEXT NOT NULL,
  title TEXT NOT NULL, -- ä¼šè¯æ ‡é¢˜ (ç¬¬ä¸€æ¡promptçš„å‰5å­—ç¬¦)
  first_prompt TEXT, -- å®Œæ•´çš„ç¬¬ä¸€æ¡prompt
  task_count INTEGER DEFAULT 0,
  last_activity TIMESTAMP NOT NULL,
  created_at TIMESTAMP DEFAULT now() NOT NULL,
  updated_at TIMESTAMP DEFAULT now() NOT NULL,

  CONSTRAINT ai_photo_sessions_user_id_fk FOREIGN KEY (user_id)
    REFERENCES public.user(id) ON DELETE cascade ON UPDATE no action
);

-- AIä»»åŠ¡è¡¨ (ai_photo_tasks) - æ–°å¢è¡¨
CREATE TABLE ai_photo_tasks (
  id TEXT PRIMARY KEY,
  user_id TEXT NOT NULL,
  session_id TEXT NOT NULL,
  prompt TEXT NOT NULL,
  input_images JSON, -- ç”¨æˆ·ä¸Šä¼ çš„å‚è€ƒå›¾ç‰‡é“¾æ¥æ•°ç»„
  output_image_url TEXT, -- AIç”Ÿæˆçš„ç»“æœå›¾ç‰‡é“¾æ¥
  status TEXT NOT NULL CHECK (status IN ('pending', 'processing', 'completed', 'failed')),
  task_id TEXT, -- ç¬¬ä¸‰æ–¹AIæ¥å£è¿”å›çš„ä»»åŠ¡ID
  provider_model TEXT, -- ä½¿ç”¨çš„AIæ¨¡å‹åç§°
  credits_cost INTEGER NOT NULL,
  error_message TEXT,
  sequence_order INTEGER NOT NULL,
  created_at TIMESTAMP DEFAULT now() NOT NULL,
  updated_at TIMESTAMP DEFAULT now() NOT NULL,
  completed_at TIMESTAMP,

  CONSTRAINT ai_photo_tasks_user_id_fk FOREIGN KEY (user_id)
    REFERENCES public.user(id) ON DELETE cascade ON UPDATE no action,
  CONSTRAINT ai_photo_tasks_session_id_fk FOREIGN KEY (session_id)
    REFERENCES public.ai_photo_sessions(id) ON DELETE cascade ON UPDATE no action
);

-- ç´¢å¼•è®¾è®¡
CREATE INDEX idx_ai_photo_sessions_user_activity ON ai_photo_sessions(user_id, last_activity DESC);
CREATE INDEX idx_ai_photo_tasks_session_order ON ai_photo_tasks(session_id, sequence_order ASC);
CREATE INDEX idx_ai_photo_tasks_task_id ON ai_photo_tasks(task_id); -- ç”¨äºwebhookæŸ¥è¯¢
CREATE INDEX idx_ai_photo_tasks_user_created ON ai_photo_tasks(user_id, created_at DESC);
CREATE INDEX idx_ai_photo_tasks_status ON ai_photo_tasks(status);

-- å¤ç”¨ç°æœ‰è¡¨ï¼š
-- - user: ç”¨æˆ·è®¤è¯å’ŒåŸºæœ¬ä¿¡æ¯
-- - user_credit: ç§¯åˆ†ä½™é¢
-- - credit_transaction: ç§¯åˆ†äº¤æ˜“è®°å½• (ç”¨äºAIå›¾ç‰‡ç”Ÿæˆæ‰£å‡ç§¯åˆ†)
```

### 4. æ ¸å¿ƒä¸šåŠ¡æµç¨‹
```typescript
// 1. å‰ç«¯è½®è¯¢å®ç°
const pollTaskStatus = async (taskId: string) => {
  let pollCount = 0;
  const maxPollCount = 13; // 40ç§’ Ã· 3ç§’

  const interval = setInterval(async () => {
    if (document.hidden) return; // ç§»åŠ¨ç«¯ä¼˜åŒ–

    pollCount++;

    try {
      const response = await fetch(`/api/tasks/${taskId}`);
      const task = await response.json();

      if (task.status === 'completed') {
        displayResult(task.output_image_url);
        clearInterval(interval);
      } else if (task.status === 'failed') {
        displayError(task.error_message);
        clearInterval(interval);
      } else if (pollCount >= maxPollCount) {
        displayTimeout("å¯¹è¯å¤±è´¥"); // 40ç§’è¶…æ—¶æç¤º
        clearInterval(interval);
      }
    } catch (error) {
      displayNetworkError("ç½‘ç»œå¼‚å¸¸"); // ç½‘ç»œå¼‚å¸¸æç¤º
      clearInterval(interval);
    }
  }, 3000);
};

// 2. Webhookå¤„ç†å®ç°
export async function POST(request: Request) {
  const webhookData = await request.json();

  try {
    // ä¸‹è½½AIç”Ÿæˆçš„å›¾ç‰‡
    const imageResponse = await fetch(webhookData.output_url);
    const imageBuffer = await imageResponse.arrayBuffer();

    // ä¸Šä¼ åˆ°æ–‡ä»¶å­˜å‚¨æœåŠ¡å™¨
    const uploadResult = await uploadToStorage(imageBuffer);

    // æ›´æ–°æ•°æ®åº“ä»»åŠ¡çŠ¶æ€
    await updateTask(webhookData.task_id, {
      status: 'completed',
      output_image_url: uploadResult.url,
      completed_at: new Date()
    });
  } catch (error) {
    await updateTask(webhookData.task_id, {
      status: 'failed',
      error_message: error.message
    });
  }
}

// 3. ç§¯åˆ†æ£€æŸ¥ä¸æ‰£å‡ - é›†æˆMkSaaSç§¯åˆ†ç³»ç»Ÿ
const processAIRequest = async (userId: string, prompt: string, selectedModel: string) => {
  const { getUserCredits, consumeCredits } = await import('@/credits/credits');
  const { CREDIT_TRANSACTION_TYPE } = await import('@/credits/types');

  // æ£€æŸ¥ç§¯åˆ† - ä½¿ç”¨ç°æœ‰ç§¯åˆ†ç³»ç»Ÿ
  const userCredits = await getUserCredits(userId);
  const model = ModelConfigManager.getModelConfig(selectedModel);

  if (userCredits < model.creditsPerUse) {
    throw new Error('ç§¯åˆ†ä¸è¶³ï¼Œè¯·å…ˆå……å€¼');
  }

  // æ‰£å‡ç§¯åˆ† (ä½¿ç”¨ç°æœ‰FIFOæ¶ˆè´¹æœºåˆ¶ï¼Œå¤±è´¥ä¸å›æ»š)
  await consumeCredits({
    userId,
    amount: model.creditsPerUse,
    description: `AIå›¾ç‰‡ç”Ÿæˆ - ${model.name}`
  });

  // è°ƒç”¨AIæ¥å£
  const aiResponse = await callAIService(prompt, selectedModel);
  return aiResponse.task_id;
};
```

### 5. AIæ¥å£æŠ½è±¡å±‚
```typescript
// AIæœåŠ¡æ¥å£æŠ½è±¡ï¼Œæ”¯æŒå¹³å°åˆ‡æ¢
interface AIService {
  createPrediction(params: CreatePredictionParams): Promise<PredictionResponse>;
  getPrediction(taskId: string): Promise<PredictionStatus>;
}

// AIæœåŠ¡å·¥å‚
class AIServiceFactory {
  static createService(provider: string = 'replicate'): AIService {
    switch (provider) {
      case 'replicate':
        return new ReplicateService(process.env.REPLICATE_API_KEY!, process.env.WEBHOOK_URL!);
      // æœªæ¥å¯ä»¥è½»æ¾æ·»åŠ å…¶ä»–å¹³å°
      default:
        throw new Error(`Unsupported AI provider: ${provider}`);
    }
  }
}
```

## ğŸ“± å“åº”å¼è®¾è®¡

### æ¡Œé¢ç«¯ (â‰¥1024px)
- ä¸‰æ å¸ƒå±€ï¼šä¾§è¾¹æ (256px) + å¯¹è¯åŒº(50%) + é¢„è§ˆåŒº(50%)
- ä¸»å›¾é¢„è§ˆå 85%é«˜åº¦ï¼Œç¼©ç•¥å›¾å 15%é«˜åº¦

### å¹³æ¿ç«¯ (768px - 1023px)
- ä¸¤æ å¸ƒå±€ï¼šå¯¹è¯åŒº + é¢„è§ˆåŒº (å„å 50%)
- ä¾§è¾¹æ æŠ˜å ä¸ºæŠ½å±‰æ¨¡å¼ï¼ˆç‚¹å‡»æŒ‰é’®è§¦å‘ï¼‰

### ç§»åŠ¨ç«¯ (<768px)
- å•æ å¸ƒå±€ï¼šå¯¹è¯åŒºå…¨å±æ˜¾ç¤º
- ä¾§è¾¹æ å’Œé¢„è§ˆåŒºå‡ä¸ºæŠ½å±‰æ¨¡å¼ï¼ˆç‚¹å‡»æŒ‰é’®è§¦å‘ï¼Œä¸æ”¯æŒæ‰‹åŠ¿æ»‘åŠ¨ï¼‰
- æš‚ä¸æ”¯æŒå…¨å±æŸ¥çœ‹åŠŸèƒ½

## ğŸ“ æ–‡ä»¶ç»“æ„è§„åˆ’

```
src/
â”œâ”€â”€ config/
â”‚   â””â”€â”€ ai-models-config.ts              # âœ¨ æ–°å»º - AIæ¨¡å‹é…ç½®æ–‡ä»¶
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ ai-elements/
â”‚   â”‚   â”œâ”€â”€ mode-toggle.tsx               # âœ¨ æ–°å»º - Chat/Canvasæ¨¡å¼åˆ‡æ¢
â”‚   â”‚   â”œâ”€â”€ recent-edit-list.tsx          # âœ¨ æ–°å»º - å†å²ä¼šè¯åˆ—è¡¨
â”‚   â”‚   â”œâ”€â”€ image-preview-panel.tsx       # âœ¨ æ–°å»º - å›¾ç‰‡é¢„è§ˆé¢æ¿
â”‚   â”‚   â”œâ”€â”€ image-upload-input.tsx        # âœ¨ æ–°å»º - å›¾ç‰‡ä¸Šä¼ è¾“å…¥
â”‚   â”‚   â”œâ”€â”€ model-selector.tsx            # âœ¨ æ–°å»º - æ¨¡å‹é€‰æ‹©å™¨
â”‚   â”‚   â”œâ”€â”€ photo-editor-sidebar.tsx      # âœ¨ æ–°å»º - å›¾ç‰‡ç¼–è¾‘ä¾§è¾¹æ 
â”‚   â”‚   â””â”€â”€ photo-editor-layout.tsx       # âœ¨ æ–°å»º - æ•´ä½“å¸ƒå±€ç»„ä»¶
â”‚   â””â”€â”€ animate-ui/buttons/               # âœ… å¤ç”¨ç°æœ‰ - åŠ¨ç”»æŒ‰é’®ç»„ä»¶
â”œâ”€â”€ ai/
â”‚   â””â”€â”€ image/
â”‚       â”œâ”€â”€ hooks/
â”‚       â”‚   â”œâ”€â”€ use-edit-sessions.ts      # âœ¨ æ–°å»º - ä¼šè¯ç®¡ç†Hook
â”‚       â”‚   â””â”€â”€ use-image-upload.ts       # âœ¨ æ–°å»º - å›¾ç‰‡ä¸Šä¼ Hook
â”‚       â””â”€â”€ lib/
â”‚           â”œâ”€â”€ edit-session-types.ts     # âœ¨ æ–°å»º - ä¼šè¯ç±»å‹å®šä¹‰
â”‚           â””â”€â”€ image-upload-utils.ts     # âœ¨ æ–°å»º - ä¸Šä¼ å·¥å…·å‡½æ•°
â””â”€â”€ app/
    â””â”€â”€ [locale]/
        â””â”€â”€ (protected)/
            â””â”€â”€ ai-photo-editor/
                â””â”€â”€ page.tsx              # âœ¨ æ–°å»º - å›¾ç‰‡ç¼–è¾‘é¡µé¢
        â””â”€â”€ api/
            â””â”€â”€ ai-photo-editor/
                â”œâ”€â”€ sessions/
                â”‚   â”œâ”€â”€ route.ts          # âœ¨ æ–°å»º - ä¼šè¯ç®¡ç†API
                â”‚   â””â”€â”€ [id]/
                â”‚       â””â”€â”€ route.ts      # âœ¨ æ–°å»º - å•ä¸ªä¼šè¯æ“ä½œAPI
                â”œâ”€â”€ process/
                â”‚   â””â”€â”€ route.ts          # âœ¨ æ–°å»º - AIå¤„ç†API
                â””â”€â”€ tasks/
                    â””â”€â”€ [taskId]/
                        â””â”€â”€ route.ts      # âœ¨ æ–°å»º - ä»»åŠ¡çŠ¶æ€æŸ¥è¯¢API
            â””â”€â”€ webhooks/
                â””â”€â”€ ai-photo-completion/
                    â””â”€â”€ route.ts          # âœ¨ æ–°å»º - AIå®Œæˆå›è°ƒAPI
```

## ğŸ“‹ å¼€å‘ä»»åŠ¡è§„åˆ’

### Phase 1: åŸºç¡€æ¶æ„å’Œæ•°æ®å±‚ (2å¤©)
- [ ] `src/db/schema.ts` - æ–°å¢AIç›¸å…³è¡¨å®šä¹‰ (aiPhotoSession, aiPhotoTask)
- [ ] æ•°æ®åº“è¿ç§»æ–‡ä»¶ç”Ÿæˆå’Œæ‰§è¡Œ
- [ ] `src/config/ai-models-config.ts` - AIæ¨¡å‹é…ç½®æ–‡ä»¶ (ä»…google/nano-banana)
- [ ] `src/ai/image/lib/types.ts` - AIç›¸å…³ç±»å‹å®šä¹‰
- [ ] åŸºç¡€APIè·¯ç”±ç»“æ„åˆ›å»º

### Phase 2: æ ¸å¿ƒç»„ä»¶å¼€å‘ (2å¤©)
- [ ] `PhotoEditorLayout` - æ•´ä½“å¸ƒå±€ç»„ä»¶
- [ ] `ModeToggle` - Chat/Canvasæ¨¡å¼åˆ‡æ¢ç»„ä»¶ (Canvaså®Œå…¨ç¦ç”¨+Coming Soon)
- [ ] `PhotoEditorSidebar` - ä¾§è¾¹æ ç»„ä»¶ (é›†æˆBetter Authç”¨æˆ·çŠ¶æ€)
- [ ] `RecentEditList` - å†å²ä¼šè¯åˆ—è¡¨ (å‰5å­—ç¬¦+æ—¶é—´)
- [ ] `ModelSelector` - æ¨¡å‹é€‰æ‹©å™¨ (é›†æˆç§¯åˆ†ç³»ç»Ÿ)

### Phase 3: APIæ¥å£å®ç° (2-3å¤©)
- [ ] `POST /api/ai-photo-editor/sessions` - åˆ›å»ºä¼šè¯API (é›†æˆBetter Authè®¤è¯)
- [ ] `GET /api/ai-photo-editor/sessions` - è·å–ä¼šè¯åˆ—è¡¨API
- [ ] `POST /api/ai-photo-editor/process` - AIå¤„ç†API (é›†æˆç§¯åˆ†æ‰£å‡)
- [ ] `GET /api/ai-photo-editor/tasks/:taskId` - ä»»åŠ¡çŠ¶æ€æŸ¥è¯¢API
- [ ] `POST /api/webhooks/ai-photo-completion` - Webhookå›è°ƒAPI
- [ ] AIæ¥å£æŠ½è±¡å±‚å®ç° (æ”¯æŒReplicateå¹³å°)

### Phase 4: å¯¹è¯å’Œé¢„è§ˆåŠŸèƒ½ (2å¤©)
- [ ] `ImageUploadInput` - å›¾ç‰‡ä¸Šä¼ è¾“å…¥ç»„ä»¶ (é›†æˆç°æœ‰å­˜å‚¨ç³»ç»Ÿ)
- [ ] `ImagePreviewPanel` - å›¾ç‰‡é¢„è§ˆé¢æ¿ (å½“å‰ä¼šè¯å›¾ç‰‡)
- [ ] ç¼©ç•¥å›¾ç‚¹å‡»åˆ‡æ¢ä¸»å›¾åŠŸèƒ½
- [ ] é›†æˆç°æœ‰å¯¹è¯ç»„ä»¶ï¼Œå®ç°å®Œæ•´å¯¹è¯æµç¨‹
- [ ] é”™è¯¯å¤„ç†ï¼šè½®è¯¢è¶…æ—¶"å¯¹è¯å¤±è´¥"ã€ç½‘ç»œå¼‚å¸¸"ç½‘ç»œå¼‚å¸¸"

### Phase 5: ç§»åŠ¨ç«¯é€‚é…å’Œä¼˜åŒ– (1-2å¤©)
- [ ] æŠ½å±‰æ¨¡å¼å®ç° (ç‚¹å‡»æŒ‰é’®è§¦å‘)
- [ ] å“åº”å¼å¸ƒå±€ä¼˜åŒ–
- [ ] ç§»åŠ¨ç«¯äº¤äº’æµ‹è¯•
- [ ] æ€§èƒ½ä¼˜åŒ–å’Œé”™è¯¯è¾¹ç•Œå¤„ç†

## ğŸ“Š ä¸šåŠ¡è§„åˆ™è¯¦ç»†è§„æ ¼

### ğŸ’° ç§¯åˆ†ç®¡ç†è§„åˆ™
- **æ‰£å‡æ—¶æœº**: è°ƒç”¨AIæ¥å£å‰å…ˆæ‰£å‡ç§¯åˆ†
- **å¤±è´¥å¤„ç†**: ç§¯åˆ†æ‰£å‡æˆåŠŸä½†AIæ¥å£å¤±è´¥æ—¶ï¼Œä¸å›æ»šç§¯åˆ†
- **ç§¯åˆ†ä¸è¶³**: æ˜¾ç¤ºç§¯åˆ†ä¸è¶³æç¤ºï¼Œå¼•å¯¼ç”¨æˆ·å……å€¼ï¼Œç¦æ­¢å‘é€å¯¹è¯

### â±ï¸ è½®è¯¢æœºåˆ¶è§„åˆ™
- **æŒç»­æ—¶é—´**: æœ€å¤š40ç§’è‡ªåŠ¨åœæ­¢è½®è¯¢ï¼Œæç¤º"å¯¹è¯å¤±è´¥"
- **è½®è¯¢é—´éš”**: æ¯3ç§’æŸ¥è¯¢ä¸€æ¬¡ä»»åŠ¡çŠ¶æ€
- **é¡µé¢çŠ¶æ€**: ä»…åœ¨æµè§ˆå™¨çª—å£æ¿€æ´»æ—¶è¿›è¡Œè½®è¯¢
- **ç½‘ç»œå¼‚å¸¸**: æç¤º"ç½‘ç»œå¼‚å¸¸"ï¼Œä¸è¿›è¡Œè‡ªåŠ¨é‡è¯•

### ğŸ“· å›¾ç‰‡å¤„ç†è§„åˆ™
- **æ–‡ä»¶å¤§å°**: å•å¼ å›¾ç‰‡æœ€å¤§æ”¯æŒ20MB
- **å›¾ç‰‡æ•°é‡**: æ”¯æŒä¸Šä¼ å¤šå¼ å›¾ç‰‡ï¼Œä¹Ÿå¯ä»¥ä¸ä¸Šä¼ å›¾ç‰‡
- **å›¾ç‰‡å¤„ç†**: æš‚ä¸è¿›è¡Œå‹ç¼©æˆ–æ ¼å¼è½¬æ¢
- **AIå¤„ç†å¤±è´¥**: ä¸æ”¯æŒé‡è¯•åŠŸèƒ½ï¼Œé‡è¯•éœ€è¦é‡æ–°æ‰£é™¤ç§¯åˆ†

### ğŸ’¬ ä¼šè¯å’Œä»»åŠ¡ç®¡ç†
- **ä¼šè¯åˆ›å»º**: æ¯æ¬¡ç‚¹å‡»"New Edit"æŒ‰é’®åˆ›å»ºæ–°ä¼šè¯
- **ä»»åŠ¡å®šä¹‰**: æ¯æ¬¡åœ¨å¯¹è¯æ¡†ä¸­å‘é€å†…å®¹ = ä¸€ä¸ªä»»åŠ¡
- **Recent Edit**: æŒ‰ä¼šè¯æ˜¾ç¤ºï¼Œå±•ç¤ºç¬¬ä¸€æ¡promptçš„å‰5å­—ç¬¦+åˆ›å»ºæ—¶é—´
- **å¹¶å‘æ§åˆ¶**: å•ä¸ªç”¨æˆ·ä¸èƒ½åŒæ—¶å‘èµ·å¤šä¸ªAIå¤„ç†ä»»åŠ¡

### ğŸ”„ ç³»ç»Ÿé›†æˆå¤ç”¨
- **ç§¯åˆ†ç³»ç»Ÿ**: å¤ç”¨ç°æœ‰é¡¹ç›®çš„ç§¯åˆ†ç®¡ç†åŠŸèƒ½
- **æ–‡ä»¶ä¸Šä¼ **: å¤ç”¨ç°æœ‰çš„æ–‡ä»¶ä¸Šä¼ é€»è¾‘å’Œå­˜å‚¨æœåŠ¡
- **ç”¨æˆ·è®¤è¯**: å¤ç”¨ç°æœ‰çš„ç”¨æˆ·è®¤è¯æœºåˆ¶
- **å›½é™…åŒ–**: æ”¯æŒä¸­è‹±åŒè¯­å›½é™…åŒ–

## ğŸ“‹ APIæ¥å£è§„èŒƒ

åŸºäºMkSaaSé¡¹ç›®çš„APIæ¶æ„ï¼Œæ–°å¢ä»¥ä¸‹æ¥å£ï¼š

### 1. ä¼šè¯ç®¡ç†API
```typescript
// POST /api/ai-photo-editor/sessions - åˆ›å»ºæ–°ä¼šè¯
interface CreateSessionRequest {
  // æ— éœ€å‚æ•°ï¼Œè‡ªåŠ¨åˆ›å»º
}

interface CreateSessionResponse {
  success: boolean;
  sessionId: string;
  error?: string;
}

// GET /api/ai-photo-editor/sessions - è·å–ç”¨æˆ·ä¼šè¯åˆ—è¡¨
interface GetSessionsResponse {
  success: boolean;
  sessions: {
    id: string;
    title: string;
    firstPrompt: string;
    taskCount: number;
    lastActivity: string;
    createdAt: string;
  }[];
  error?: string;
}

// PUT /api/ai-photo-editor/sessions/:id - æ›´æ–°ä¼šè¯
interface UpdateSessionRequest {
  title?: string;
  lastActivity?: string;
}
```

### 2. AIå¤„ç†API
```typescript
// POST /api/ai-photo-editor/process - å¤„ç†AIå›¾ç‰‡ç”Ÿæˆè¯·æ±‚
interface ProcessAIRequest {
  sessionId: string;
  prompt: string;
  inputImages?: string[]; // ä¸Šä¼ åçš„å›¾ç‰‡URLæ•°ç»„
  modelId: string; // 'google/nano-banana'
}

interface ProcessAIResponse {
  success: boolean;
  taskId: string;
  error?: string;
}

// GET /api/ai-photo-editor/tasks/:taskId - æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€
interface GetTaskStatusResponse {
  success: boolean;
  task: {
    id: string;
    status: 'pending' | 'processing' | 'completed' | 'failed';
    outputImageUrl?: string;
    errorMessage?: string;
    createdAt: string;
    completedAt?: string;
  };
  error?: string;
}
```

### 3. æ–‡ä»¶ä¸Šä¼ API (å¤ç”¨ç°æœ‰)
```typescript
// POST /api/storage/upload - å›¾ç‰‡ä¸Šä¼  (ç°æœ‰æ¥å£)
// ä½¿ç”¨ç°æœ‰çš„ uploadFileFromBrowser å‡½æ•°
// æ”¯æŒfolderå‚æ•°: 'ai-photo-editor'
```

### 4. Webhook API
```typescript
// POST /api/webhooks/ai-photo-completion - AIå®Œæˆå›è°ƒ
interface WebhookRequest {
  taskId: string;
  status: 'completed' | 'failed';
  outputUrl?: string;
  errorMessage?: string;
}
```

### 5. è®¤è¯ä¸­é—´ä»¶
```typescript
// ä½¿ç”¨ç°æœ‰çš„Better Authè®¤è¯ç³»ç»Ÿ
import { getSession } from '@/lib/server';

export async function authMiddleware(request: Request) {
  const session = await getSession();
  if (!session?.user) {
    return new Response('Unauthorized', { status: 401 });
  }
  return session.user;
}
```

## ğŸš€ éƒ¨ç½²å’Œæµ‹è¯•

### ç¯å¢ƒå˜é‡æ£€æŸ¥ (åŸºäºMkSaaSé¡¹ç›®)
```bash
# ç°æœ‰ç¯å¢ƒå˜é‡ (å·²é…ç½®)
STORAGE_BUCKET_NAME=""
STORAGE_ACCESS_KEY_ID=""
STORAGE_SECRET_ACCESS_KEY=""
STORAGE_ENDPOINT=""
STORAGE_PUBLIC_URL=""

# æ–°å¢AIç›¸å…³ç¯å¢ƒå˜é‡
REPLICATE_API_KEY=""
WEBHOOK_URL=""
AI_PHOTO_MODEL_ENDPOINT=""

# è®¤è¯ç›¸å…³ (å·²å­˜åœ¨)
BETTER_AUTH_SECRET=""
BETTER_AUTH_URL=""

# æ•°æ®åº“ (å·²å­˜åœ¨)
DATABASE_URL=""
```

### æ•°æ®åº“è¿ç§» (Drizzle ORM)
```bash
# 1. åˆ›å»ºæ–°çš„è¿ç§»æ–‡ä»¶
npm run db:generate

# 2. æ‰§è¡Œè¿ç§» (åŸºäºç°æœ‰MkSaaSè¿ç§»æµç¨‹)
npm run db:migrate

# 3. éªŒè¯è¡¨ç»“æ„
npm run db:studio # æ‰“å¼€Drizzle StudioæŸ¥çœ‹è¡¨ç»“æ„
```

### Drizzle Schemaæ›´æ–°
```typescript
// src/db/schema.ts - æ–°å¢AIç›¸å…³è¡¨å®šä¹‰
import { boolean, integer, pgTable, text, timestamp, index, json } from "drizzle-orm/pg-core";
import { user } from './schema'; // å¯¼å…¥ç°æœ‰userè¡¨

export const aiPhotoSession = pgTable("ai_photo_session", {
  id: text("id").primaryKey(),
  userId: text("user_id").notNull().references(() => user.id, { onDelete: 'cascade' }),
  title: text("title").notNull(),
  firstPrompt: text("first_prompt"),
  taskCount: integer("task_count").default(0).notNull(),
  lastActivity: timestamp("last_activity").notNull(),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
}, (table) => ({
  userActivityIdx: index("ai_photo_session_user_activity_idx").on(table.userId, table.lastActivity),
  userCreatedIdx: index("ai_photo_session_user_created_idx").on(table.userId, table.createdAt),
}));

export const aiPhotoTask = pgTable("ai_photo_task", {
  id: text("id").primaryKey(),
  userId: text("user_id").notNull().references(() => user.id, { onDelete: 'cascade' }),
  sessionId: text("session_id").notNull().references(() => aiPhotoSession.id, { onDelete: 'cascade' }),
  prompt: text("prompt").notNull(),
  inputImages: json("input_images"), // string[]
  outputImageUrl: text("output_image_url"),
  status: text("status").notNull(), // 'pending' | 'processing' | 'completed' | 'failed'
  taskId: text("task_id"), // ç¬¬ä¸‰æ–¹AIä»»åŠ¡ID
  providerModel: text("provider_model"),
  creditsCost: integer("credits_cost").notNull(),
  errorMessage: text("error_message"),
  sequenceOrder: integer("sequence_order").notNull(),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
  completedAt: timestamp("completed_at"),
}, (table) => ({
  sessionOrderIdx: index("ai_photo_task_session_order_idx").on(table.sessionId, table.sequenceOrder),
  taskIdIdx: index("ai_photo_task_task_id_idx").on(table.taskId),
  userCreatedIdx: index("ai_photo_task_user_created_idx").on(table.userId, table.createdAt),
  statusIdx: index("ai_photo_task_status_idx").on(table.status),
}));
```

### æˆåŠŸæŒ‡æ ‡
- [ ] æ–°å»ºä¼šè¯åŠŸèƒ½æ­£å¸¸
- [ ] å†å²ä¼šè¯å±•ç¤ºå’Œåˆ‡æ¢æ­£å¸¸
- [ ] å›¾ç‰‡ä¸Šä¼ å’Œé¢„è§ˆæ­£å¸¸
- [ ] AIæ¨¡å‹é€‰æ‹©å’Œç§¯åˆ†æ‰£å‡æ­£å¸¸
- [ ] è½®è¯¢å’Œé”™è¯¯å¤„ç†æ­£å¸¸
- [ ] å“åº”å¼å¸ƒå±€é€‚é…

---

## âœ… å¼€å‘ä»»åŠ¡åˆ¶å®šå®Œæˆ

**ä»»åŠ¡åˆ¶å®šæ—¶é—´:** 2025-09-13T23:29:33+08:00
**ä»»åŠ¡æ€»æ•°:** 16ä¸ªå¼€å‘ä»»åŠ¡
**é¢„è®¡å®Œæˆæ—¶é—´:** 9-11å¤©

### ğŸ“Š ä»»åŠ¡é˜¶æ®µåˆ†å¸ƒ

| é˜¶æ®µ | ä»»åŠ¡æ•° | ä¸»è¦å†…å®¹ | é¢„è®¡æ—¶é—´ |
|------|--------|----------|----------|
| Phase 1 | 2ä¸ª | åŸºç¡€æ¶æ„å’Œæ•°æ®å±‚ | 2å¤© |
| Phase 2 | 4ä¸ª | æ ¸å¿ƒç»„ä»¶å¼€å‘ | 2å¤© |
| Phase 3 | 3ä¸ª | APIæ¥å£å®ç° | 2-3å¤© |
| Phase 4 | 5ä¸ª | å¯¹è¯å’Œé¢„è§ˆåŠŸèƒ½ | 2å¤© |
| Phase 5 | 2ä¸ª | ç§»åŠ¨ç«¯é€‚é…å’Œä¼˜åŒ– | 1-2å¤© |

### ğŸ¯ å…³é”®ä»»åŠ¡èŠ‚ç‚¹

1. **Task 1**: æ•°æ®åº“Schemaè®¾è®¡å’Œè¿ç§» (æ— ä¾èµ–ï¼Œå¯ç«‹å³å¼€å§‹)
2. **Task 7**: ä¼šè¯ç®¡ç†APIæ¥å£ (å‰ç«¯ç»„ä»¶çš„æ•°æ®åŸºç¡€)
3. **Task 14**: AIå›¾ç‰‡ç¼–è¾‘ä¸»é¡µé¢ (æ‰€æœ‰åŠŸèƒ½çš„é›†æˆç‚¹)
4. **Task 16**: æ€§èƒ½ä¼˜åŒ–å’Œé”™è¯¯è¾¹ç•Œ (æœ€ç»ˆå®Œå–„)

### ğŸ“‹ ä½¿ç”¨ä»»åŠ¡ç®¡ç†ç³»ç»Ÿ

```bash
# æŸ¥çœ‹å½“å‰ä»»åŠ¡çŠ¶æ€
ä»»åŠ¡ç®¡ç†ç³»ç»Ÿä¼šæ˜¾ç¤ºæ‰€æœ‰16ä¸ªä»»åŠ¡çš„è¯¦ç»†ä¿¡æ¯

# å¼€å§‹ç¬¬ä¸€ä¸ªä»»åŠ¡
ä»"æ•°æ®åº“Schemaè®¾è®¡å’Œè¿ç§»"å¼€å§‹å¼€å‘

# å®Œæˆä»»åŠ¡åæ›´æ–°çŠ¶æ€
æ¯å®Œæˆä¸€ä¸ªä»»åŠ¡ç«‹å³æ ‡è®°ä¸ºcompletedçŠ¶æ€

# æŸ¥çœ‹ä¸‹ä¸€ä¸ªå¯æ‰§è¡Œä»»åŠ¡
ç³»ç»Ÿä¼šæ ¹æ®ä¾èµ–å…³ç³»æ˜¾ç¤ºå¯ä»¥å¼€å§‹çš„ä»»åŠ¡
```

### ğŸ”„ å¼€å‘æµç¨‹å»ºè®®

1. **ä¸¥æ ¼æŒ‰ä¾èµ–é¡ºåº**: ç¡®ä¿å‰ç½®ä»»åŠ¡å®Œæˆåå†å¼€å§‹åç»­ä»»åŠ¡
2. **å¹¶è¡Œå¼€å‘æœºä¼š**: æ— ä¾èµ–å…³ç³»çš„ä»»åŠ¡å¯ä»¥å¹¶è¡Œè¿›è¡Œ
3. **é˜¶æ®µæ€§éªŒæ”¶**: æ¯ä¸ªPhaseå®Œæˆåè¿›è¡Œé›†æˆæµ‹è¯•
4. **æŒç»­é›†æˆ**: æ¯ä¸ªä»»åŠ¡å®Œæˆåç«‹å³é›†æˆåˆ°ä¸»åˆ†æ”¯
5. **æ–‡æ¡£åŒæ­¥**: å¼€å‘è¿‡ç¨‹ä¸­åŠæ—¶æ›´æ–°ç›¸å…³æ–‡æ¡£

**ç°åœ¨å¯ä»¥å¼€å§‹æŒ‰ç…§ä»»åŠ¡æ¸…å•è¿›è¡Œæœ‰åºå¼€å‘ï¼** ğŸš€
